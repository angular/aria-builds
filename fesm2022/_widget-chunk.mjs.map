{"version":3,"file":"_widget-chunk.mjs","sources":["../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/keyboard-event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/event-manager/pointer-event-manager.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-data.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-focus.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-navigation.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid-selection.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/behaviors/grid/grid.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/grid.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/row.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/cell.ts","../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/private/grid/widget.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n/**\n * An event that supports modifier keys.\n *\n * Matches the native KeyboardEvent, MouseEvent, and TouchEvent.\n */\nexport interface EventWithModifiers extends Event {\n  ctrlKey: boolean;\n  shiftKey: boolean;\n  altKey: boolean;\n  metaKey: boolean;\n}\n\n/**\n * Options that are applicable to all event handlers.\n *\n * This library has not yet had a need for stopPropagationImmediate.\n */\nexport interface EventHandlerOptions {\n  stopPropagation: boolean;\n  preventDefault: boolean;\n}\n\n/** A basic event handler. */\nexport type EventHandler<T extends Event> = (event: T) => void;\n\n/** A function that determines whether an event is to be handled. */\nexport type EventMatcher<T extends Event> = (event: T) => boolean;\n\n/** A config that specifies how to handle a particular event. */\nexport interface EventHandlerConfig<T extends Event> extends EventHandlerOptions {\n  matcher: EventMatcher<T>;\n  handler: EventHandler<T>;\n}\n\n/** Bit flag representation of the possible modifier keys that can be present on an event. */\nexport enum Modifier {\n  None = 0,\n  Ctrl = 0b1,\n  Shift = 0b10,\n  Alt = 0b100,\n  Meta = 0b1000,\n  Any = 'Any',\n}\n\nexport type ModifierInputs = Modifier | Modifier[];\n\n/**\n * Abstract base class for all event managers.\n *\n * Event managers are designed to normalize how event handlers are authored and create a safety net\n * for common event handling gotchas like remembering to call preventDefault or stopPropagation.\n */\nexport abstract class EventManager<T extends Event> {\n  protected configs: EventHandlerConfig<T>[] = [];\n  abstract options: EventHandlerOptions;\n\n  /** Runs the handlers that match with the given event. */\n  handle(event: T): void {\n    for (const config of this.configs) {\n      if (config.matcher(event)) {\n        config.handler(event);\n\n        if (config.preventDefault) {\n          event.preventDefault();\n        }\n\n        if (config.stopPropagation) {\n          event.stopPropagation();\n        }\n      }\n    }\n  }\n\n  /** Configures the event manager to handle specific events. (See subclasses for more). */\n  abstract on(...args: [...unknown[]]): this;\n}\n\n/** Gets bit flag representation of the modifier keys present on the given event. */\nexport function getModifiers(event: EventWithModifiers): number {\n  return (\n    (+event.ctrlKey && Modifier.Ctrl) |\n    (+event.shiftKey && Modifier.Shift) |\n    (+event.altKey && Modifier.Alt) |\n    (+event.metaKey && Modifier.Meta)\n  );\n}\n\n/**\n * Checks if the given event has modifiers that are an exact match for any of the given modifier\n * flag combinations.\n */\nexport function hasModifiers(event: EventWithModifiers, modifiers: ModifierInputs): boolean {\n  const eventModifiers = getModifiers(event);\n  const modifiersList = Array.isArray(modifiers) ? modifiers : [modifiers];\n\n  if (modifiersList.includes(Modifier.Any)) {\n    return true;\n  }\n\n  return modifiersList.some(modifiers => eventModifiers === modifiers);\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike} from '../signal-like/signal-like';\nimport {\n  EventHandler,\n  EventHandlerOptions,\n  EventManager,\n  hasModifiers,\n  ModifierInputs,\n  Modifier,\n} from './event-manager';\n\n/**\n * Used to represent a keycode.\n *\n * This is used to match whether an events keycode should be handled. The ability to match using a\n * string, SignalLike, or Regexp gives us more flexibility when authoring event handlers.\n */\ntype KeyCode = string | SignalLike<string> | RegExp;\n\n/**\n * An event manager that is specialized for handling keyboard events. By default this manager stops\n * propagation and prevents default on all events it handles.\n */\nexport class KeyboardEventManager<T extends KeyboardEvent> extends EventManager<T> {\n  options: EventHandlerOptions = {\n    preventDefault: true,\n    stopPropagation: true,\n  };\n\n  /** Configures this event manager to handle events with a specific key and no modifiers. */\n  on(key: KeyCode, handler: EventHandler<T>, options?: Partial<EventHandlerOptions>): this;\n\n  /**  Configures this event manager to handle events with a specific modifer and key combination. */\n  on(\n    modifiers: ModifierInputs,\n    key: KeyCode,\n    handler: EventHandler<T>,\n    options?: Partial<EventHandlerOptions>,\n  ): this;\n\n  on(...args: any[]) {\n    const {modifiers, key, handler, options} = this._normalizeInputs(...args);\n\n    this.configs.push({\n      handler: handler,\n      matcher: event => this._isMatch(event, key, modifiers),\n      ...this.options,\n      ...options,\n    });\n\n    return this;\n  }\n\n  private _normalizeInputs(...args: any[]) {\n    const withModifiers = Array.isArray(args[0]) || args[0] in Modifier;\n    const modifiers = withModifiers ? args[0] : Modifier.None;\n    const key = withModifiers ? args[1] : args[0];\n    const handler = withModifiers ? args[2] : args[1];\n    const options = withModifiers ? args[3] : args[2];\n\n    return {\n      key: key as KeyCode,\n      handler: handler as EventHandler<T>,\n      modifiers: modifiers as ModifierInputs,\n      options: (options ?? {}) as Partial<EventHandlerOptions>,\n    };\n  }\n\n  private _isMatch(event: T, key: KeyCode, modifiers: ModifierInputs) {\n    if (!hasModifiers(event, modifiers)) {\n      return false;\n    }\n\n    if (key instanceof RegExp) {\n      return key.test(event.key);\n    }\n\n    const keyStr = typeof key === 'string' ? key : key();\n    return keyStr.toLowerCase() === event.key.toLowerCase();\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  EventHandler,\n  EventHandlerOptions,\n  EventManager,\n  hasModifiers,\n  ModifierInputs,\n  Modifier,\n} from './event-manager';\n\n/**\n * The different mouse buttons that may appear on a pointer event.\n */\nexport enum MouseButton {\n  Main = 0,\n  Auxiliary = 1,\n  Secondary = 2,\n}\n\n/** An event manager that is specialized for handling pointer events. */\nexport class PointerEventManager<T extends PointerEvent> extends EventManager<T> {\n  options: EventHandlerOptions = {\n    preventDefault: false,\n    stopPropagation: false,\n  };\n\n  /**\n   * Configures this event manager to handle events with a specific modifer and mouse button\n   * combination.\n   */\n  on(button: MouseButton, modifiers: ModifierInputs, handler: EventHandler<T>): this;\n\n  /**\n   * Configures this event manager to handle events with a specific mouse button and no modifiers.\n   */\n  on(modifiers: ModifierInputs, handler: EventHandler<T>): this;\n\n  /**\n   * Configures this event manager to handle events with the main mouse button and no modifiers.\n   *\n   * @param handler The handler function\n   * @param options Options for whether to stop propagation or prevent default.\n   */\n  on(handler: EventHandler<T>): this;\n\n  on(...args: any[]) {\n    const {button, handler, modifiers} = this._normalizeInputs(...args);\n\n    this.configs.push({\n      handler,\n      matcher: event => this._isMatch(event, button, modifiers),\n      ...this.options,\n    });\n    return this;\n  }\n\n  private _normalizeInputs(...args: any[]) {\n    if (args.length === 3) {\n      return {\n        button: args[0] as MouseButton,\n        modifiers: args[1] as ModifierInputs,\n        handler: args[2] as EventHandler<T>,\n      };\n    }\n\n    if (args.length === 2) {\n      return {\n        button: MouseButton.Main,\n        modifiers: args[0] as ModifierInputs,\n        handler: args[1] as EventHandler<T>,\n      };\n    }\n\n    return {\n      button: MouseButton.Main,\n      modifiers: Modifier.None,\n      handler: args[0] as EventHandler<T>,\n    };\n  }\n\n  _isMatch(event: PointerEvent, button: MouseButton, modifiers: ModifierInputs) {\n    return button === (event.button ?? 0) && hasModifiers(event, modifiers);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\n\n/** Represents coordinates in a grid. */\nexport interface RowCol {\n  /** The row index. */\n  row: number;\n\n  /** The column index. */\n  col: number;\n}\n\n/** A string representation of grid coordinates. */\ntype CoordString = `${RowCol['row']}:${RowCol['col']}`;\n\n/** The base interface for a cell in a grid. */\nexport interface BaseGridCell {\n  /** The number of rows the cell should span. */\n  rowSpan: SignalLike<number>;\n\n  /** The number of columns the cell should span. */\n  colSpan: SignalLike<number>;\n}\n\n/** Represents the required inputs for GridData. */\nexport interface GridDataInputs<T extends BaseGridCell> {\n  /** The two-dimensional array of cells that represents the grid. */\n  cells: SignalLike<T[][]>;\n}\n\n/** Controls internal coordinates for a grid of items. */\nexport class GridData<T extends BaseGridCell> {\n  /** The two-dimensional array of cells that represents the grid. */\n  readonly cells: SignalLike<T[][]>;\n\n  /** The maximum number of rows in the grid, accounting for row spans. */\n  readonly maxRowCount = computed<number>(() => Math.max(...this._rowCountByCol().values(), 0));\n\n  /** The maximum number of columns in the grid, accounting for column spans. */\n  readonly maxColCount = computed<number>(() => Math.max(...this._colCountsByRow().values(), 0));\n\n  /** A map from a cell to its primary and spanned coordinates. */\n  private readonly _coordsMap = computed<Map<T, {coords: RowCol; spanCoords: RowCol[]}>>(() => {\n    const coordsMap = new Map();\n    const visitedCoords = new Set();\n\n    for (let rowIndex = 0; rowIndex < this.cells().length; rowIndex++) {\n      let colIndex = 0;\n      const row = this.cells()[rowIndex];\n\n      for (const cell of row) {\n        // Skip past cells that are already taken.\n        while (visitedCoords.has(`${rowIndex}:${colIndex}`)) {\n          colIndex++;\n        }\n\n        const rowspan = cell.rowSpan();\n        const colspan = cell.colSpan();\n        const spanCoords: RowCol[] = [];\n\n        for (let rowOffset = 0; rowOffset < rowspan; rowOffset++) {\n          const row = rowIndex + rowOffset;\n          for (let colOffset = 0; colOffset < colspan; colOffset++) {\n            const col = colIndex + colOffset;\n            visitedCoords.add(`${row}:${col}`);\n            spanCoords.push({row, col});\n          }\n        }\n        coordsMap.set(cell, {coords: spanCoords[0], spanCoords});\n\n        colIndex += colspan;\n      }\n    }\n\n    return coordsMap;\n  });\n\n  /** A map from a coordinate string to the cell at that coordinate. */\n  private readonly _cellMap = computed<Map<CoordString, T>>(() => {\n    const cellMap = new Map();\n    for (const [cell, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        cellMap.set(`${row}:${col}`, cell);\n      }\n    }\n    return cellMap;\n  });\n\n  /** A map from a row index to the number of columns in that row. */\n  private readonly _colCountsByRow = computed<Map<number, number>>(() => {\n    const colCountByRow = new Map();\n    for (const [_, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        const colCount = colCountByRow.get(row);\n        const newColCount = col + 1;\n        if (colCount === undefined || colCount < newColCount) {\n          colCountByRow.set(row, newColCount);\n        }\n      }\n    }\n    return colCountByRow;\n  });\n\n  /** A map from a column index to the number of rows in that column. */\n  private readonly _rowCountByCol = computed<Map<number, number>>(() => {\n    const rowCountByCol = new Map();\n    for (const [_, {spanCoords}] of this._coordsMap().entries()) {\n      for (const {row, col} of spanCoords) {\n        const rowCount = rowCountByCol.get(col);\n        const newRowCount = row + 1;\n        if (rowCount === undefined || rowCount < newRowCount) {\n          rowCountByCol.set(col, newRowCount);\n        }\n      }\n    }\n    return rowCountByCol;\n  });\n\n  constructor(readonly inputs: GridDataInputs<T>) {\n    this.cells = this.inputs.cells;\n  }\n\n  /** Gets the cell at the given coordinates. */\n  getCell(rowCol: RowCol): T | undefined {\n    return this._cellMap().get(`${rowCol.row}:${rowCol.col}`);\n  }\n\n  /** Gets the primary coordinates of the given cell. */\n  getCoords(cell: T): RowCol | undefined {\n    return this._coordsMap().get(cell)?.coords;\n  }\n\n  /** Gets all coordinates that the given cell spans. */\n  getAllCoords(cell: T): RowCol[] | undefined {\n    return this._coordsMap().get(cell)?.spanCoords;\n  }\n\n  /** Gets the number of rows in the given column. */\n  getRowCount(col: number): number | undefined {\n    return this._rowCountByCol().get(col);\n  }\n\n  /** Gets the number of columns in the given row. */\n  getColCount(row: number): number | undefined {\n    return this._colCountsByRow().get(row);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\nimport type {GridData, BaseGridCell, RowCol} from './grid-data';\n\n/** Represents an cell in a grid, such as a grid cell, that may receive focus. */\nexport interface GridFocusCell extends BaseGridCell {\n  /** A unique identifier for the cell. */\n  id: SignalLike<string>;\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement>;\n\n  /** Whether a cell is disabled. */\n  disabled: SignalLike<boolean>;\n}\n\n/** Represents the required inputs for a grid that contains focusable cells. */\nexport interface GridFocusInputs {\n  /** The focus strategy used by the grid. */\n  focusMode: SignalLike<'roving' | 'activedescendant'>;\n\n  /** Whether the grid is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** Whether disabled cells in the grid should be focusable. */\n  softDisabled: SignalLike<boolean>;\n}\n\n/** Dependencies for the `GridFocus` class. */\ninterface GridFocusDeps<T extends GridFocusCell> {\n  /** The `GridData` instance that this focus manager operates on. */\n  grid: GridData<T>;\n}\n\n/** Controls focus for a 2D grid of cells. */\nexport class GridFocus<T extends GridFocusCell> {\n  /** The current active cell. */\n  readonly activeCell = signal<T | undefined>(undefined);\n\n  /** The current active cell coordinates. */\n  readonly activeCoords = signal<RowCol>({row: -1, col: -1});\n\n  /** Whether the grid active state is empty (no active cell or coordinates). */\n  readonly stateEmpty = computed(\n    () =>\n      this.activeCell() === undefined ||\n      (this.activeCoords().row === -1 && this.activeCoords().col === -1),\n  );\n\n  /**\n   * Whether the grid focus state is stale.\n   *\n   * A stale state means the active cell or coordinates are no longer valid based on the\n   * current grid data, for example if the underlying cells have changed.\n   * A stale state should be re-initialized.\n   */\n  readonly stateStale = computed(() => {\n    if (this.stateEmpty()) {\n      return true;\n    }\n\n    const activeCell = this.activeCell();\n    const activeCellCoords = this.inputs.grid.getCoords(activeCell!);\n    const activeCoords = this.activeCoords();\n    const activeCoordsCell = this.inputs.grid.getCell(activeCoords);\n\n    const activeCellNotValid = activeCellCoords === undefined;\n    const activeCellMismatch = activeCell !== activeCoordsCell;\n    return activeCellNotValid || activeCellMismatch;\n  });\n\n  /** The id of the current active cell, for ARIA activedescendant. */\n  readonly activeDescendant = computed<string | undefined>(() => {\n    if (this.gridDisabled() || this.inputs.focusMode() === 'roving') {\n      return undefined;\n    }\n    const currentActiveCell = this.activeCell();\n    return currentActiveCell ? currentActiveCell.id() : undefined;\n  });\n\n  /** Whether the grid is in a disabled state. */\n  readonly gridDisabled = computed<boolean>(() => {\n    if (this.inputs.disabled()) {\n      return true;\n    }\n    const gridCells = this.inputs.grid.cells();\n    return gridCells.length === 0 || gridCells.every(row => row.every(cell => cell.disabled()));\n  });\n\n  /** The tab index for the grid container. */\n  readonly gridTabIndex = computed<-1 | 0>(() => {\n    if (this.gridDisabled()) {\n      return 0;\n    }\n    return this.inputs.focusMode() === 'activedescendant' ? 0 : -1;\n  });\n\n  constructor(readonly inputs: GridFocusInputs & GridFocusDeps<T>) {}\n\n  /** Returns the tab index for the given grid cell cell. */\n  getCellTabIndex(cell: T): -1 | 0 {\n    if (this.gridDisabled()) {\n      return -1;\n    }\n    if (this.inputs.focusMode() === 'activedescendant') {\n      return -1;\n    }\n    return this.activeCell() === cell ? 0 : -1;\n  }\n\n  /** Returns true if the given cell can be navigated to. */\n  isFocusable(cell: T): boolean {\n    return !cell.disabled() || this.inputs.softDisabled();\n  }\n\n  /** Focuses the given cell. */\n  focusCell(cell: T): boolean {\n    if (this.gridDisabled()) {\n      return false;\n    }\n\n    if (!this.isFocusable(cell)) {\n      return false;\n    }\n\n    if (this.inputs.grid.getCoords(cell) === undefined) {\n      return false;\n    }\n\n    this.activeCoords.set(this.inputs.grid.getCoords(cell)!);\n    this.activeCell.set(cell);\n\n    return true;\n  }\n\n  /** Moves focus to the cell at the given coordinates if it's part of a focusable cell. */\n  focusCoordinates(coords: RowCol): boolean {\n    if (this.gridDisabled()) {\n      return false;\n    }\n\n    const cell = this.inputs.grid.getCell(coords);\n\n    if (!cell || !this.isFocusable(cell)) {\n      return false;\n    }\n\n    if (this.inputs.grid.getCell(coords) === undefined) {\n      return false;\n    }\n\n    this.activeCoords.set(coords);\n    this.activeCell.set(this.inputs.grid.getCell(coords));\n\n    return true;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {GridData, RowCol} from './grid-data';\n\n/** A utility type that ensures an object has exactly one key from a given set. */\ntype ExactlyOneKey<T, K extends keyof T = keyof T> = {\n  [P in K]: Record<P, T[P]> & Partial<Record<Exclude<K, P>, never>>;\n}[K];\n\n/** Represents a directional change in the grid, either by row or by column. */\ntype Delta = ExactlyOneKey<{row: -1 | 1; col: -1 | 1}>;\n\n/** Constants for the four cardinal directions. */\nexport const direction: Record<'Up' | 'Down' | 'Left' | 'Right', Delta> = {\n  Up: {row: -1},\n  Down: {row: 1},\n  Left: {col: -1},\n  Right: {col: 1},\n} as const;\n\n/** The wrapping behavior for keyboard navigation. */\nexport type WrapStrategy = 'continuous' | 'loop' | 'nowrap';\n\n/** Represents an item in a collection, such as a listbox option, than can be navigated to. */\nexport interface GridNavigationCell extends GridFocusCell {}\n\n/** Represents the required inputs for a collection that has navigable items. */\nexport interface GridNavigationInputs extends GridFocusInputs {\n  /** The wrapping behavior for keyboard navigation along the row axis. */\n  rowWrap: SignalLike<WrapStrategy>;\n\n  /** The wrapping behavior for keyboard navigation along the column axis. */\n  colWrap: SignalLike<WrapStrategy>;\n}\n\n/** Dependencies for the `GridNavigation` class. */\ninterface GridNavigationDeps<T extends GridNavigationCell> {\n  /** The `GridData` instance that this navigation manager operates on. */\n  grid: GridData<T>;\n\n  /** The `GridFocus` instance that this navigation manager uses to manage focus. */\n  gridFocus: GridFocus<T>;\n}\n\n/** Controls navigation for a grid of items. */\nexport class GridNavigation<T extends GridNavigationCell> {\n  /** The maximum number of steps to take when searching for the next cell. */\n  private _maxSteps = computed<number>(\n    () => this.inputs.grid.maxRowCount() * this.inputs.grid.maxColCount(),\n  );\n\n  constructor(readonly inputs: GridNavigationInputs & GridNavigationDeps<T>) {}\n\n  /** Navigates to the given item. */\n  gotoCell(cell: T): boolean {\n    return this.inputs.gridFocus.focusCell(cell);\n  }\n\n  /** Navigates to the given coordinates. */\n  gotoCoords(coords: RowCol): boolean {\n    return this.inputs.gridFocus.focusCoordinates(coords);\n  }\n\n  /**\n   * Gets the coordinates of the next focusable cell in a given direction, without changing focus.\n   */\n  peek(\n    direction: Delta,\n    fromCoords: RowCol,\n    wrap?: WrapStrategy,\n    allowDisabled?: boolean,\n  ): RowCol | undefined {\n    wrap = wrap ?? (direction.row !== undefined ? this.inputs.rowWrap() : this.inputs.colWrap());\n    return this._peekDirectional(direction, fromCoords, wrap, allowDisabled);\n  }\n\n  /**\n   * Navigates to the next focusable cell in a given direction.\n   */\n  advance(direction: Delta): boolean {\n    const nextCoords = this.peek(direction, this.inputs.gridFocus.activeCoords());\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Gets the coordinates of the first focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  peekFirst(row?: number, allowDisabled?: boolean): RowCol | undefined {\n    const fromCoords = {\n      row: row ?? 0,\n      col: -1,\n    };\n    return row === undefined\n      ? this._peekDirectional(direction.Right, fromCoords, 'continuous', allowDisabled)\n      : this._peekDirectional(direction.Right, fromCoords, 'nowrap', allowDisabled);\n  }\n\n  /**\n   * Navigates to the first focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  first(row?: number): boolean {\n    const nextCoords = this.peekFirst(row);\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Gets the coordinates of the last focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  peekLast(row?: number, allowDisabled?: boolean): RowCol | undefined {\n    const fromCoords = {\n      row: row ?? this.inputs.grid.maxRowCount() - 1,\n      col: this.inputs.grid.maxColCount(),\n    };\n    return row === undefined\n      ? this._peekDirectional(direction.Left, fromCoords, 'continuous', allowDisabled)\n      : this._peekDirectional(direction.Left, fromCoords, 'nowrap', allowDisabled);\n  }\n\n  /**\n   * Navigates to the last focusable cell.\n   * If a row is not provided, searches the entire grid.\n   */\n  last(row?: number): boolean {\n    const nextCoords = this.peekLast(row);\n    return !!nextCoords && this.gotoCoords(nextCoords);\n  }\n\n  /**\n   * Finds the next focusable cell in a given direction based on the wrapping behavior.\n   */\n  private _peekDirectional(\n    delta: Delta,\n    fromCoords: RowCol,\n    wrap: 'continuous' | 'loop' | 'nowrap',\n    allowDisabled: boolean = false,\n  ): RowCol | undefined {\n    if (this.inputs.gridFocus.gridDisabled()) return undefined;\n\n    const fromCell = this.inputs.grid.getCell(fromCoords);\n    const maxRowCount = this.inputs.grid.maxRowCount();\n    const maxColCount = this.inputs.grid.maxColCount();\n    const rowDelta = delta.row ?? 0;\n    const colDelta = delta.col ?? 0;\n    let nextCoords = {...fromCoords};\n\n    for (let step = 0; step < this._maxSteps(); step++) {\n      const isWrapping =\n        nextCoords.col + colDelta < 0 ||\n        nextCoords.col + colDelta >= maxColCount ||\n        nextCoords.row + rowDelta < 0 ||\n        nextCoords.row + rowDelta >= maxRowCount;\n\n      if (wrap === 'nowrap' && isWrapping) return;\n\n      if (wrap === 'continuous') {\n        const generalDelta = delta.row ?? delta.col;\n        const rowStep = isWrapping ? generalDelta : rowDelta;\n        const colStep = isWrapping ? generalDelta : colDelta;\n\n        nextCoords = {\n          row: (nextCoords.row + rowStep + maxRowCount) % maxRowCount,\n          col: (nextCoords.col + colStep + maxColCount) % maxColCount,\n        };\n      }\n\n      if (wrap === 'loop') {\n        nextCoords = {\n          row: (nextCoords.row + rowDelta + maxRowCount) % maxRowCount,\n          col: (nextCoords.col + colDelta + maxColCount) % maxColCount,\n        };\n      }\n\n      if (wrap === 'nowrap') {\n        nextCoords = {\n          row: nextCoords.row + rowDelta,\n          col: nextCoords.col + colDelta,\n        };\n      }\n\n      // Back to original coordinates.\n      if (nextCoords.row === fromCoords.row && nextCoords.col === fromCoords.col) {\n        return undefined;\n      }\n\n      const nextCell = this.inputs.grid.getCell(nextCoords);\n      if (\n        nextCell !== undefined &&\n        nextCell !== fromCell &&\n        (allowDisabled || this.inputs.gridFocus.isFocusable(nextCell))\n      ) {\n        return nextCoords;\n      }\n    }\n\n    return undefined;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike, WritableSignalLike} from '../signal-like/signal-like';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {GridData, RowCol} from './grid-data';\nimport {signal} from '@angular/core';\n\n/** Represents a cell in a grid that can be selected. */\nexport interface GridSelectionCell extends GridFocusCell {\n  /** Whether the cell is selected. */\n  selected: WritableSignalLike<boolean>;\n\n  /** Whether the cell is selectable. */\n  selectable: SignalLike<boolean>;\n}\n\n/** Represents the required inputs for a grid that has selectable cells. */\nexport interface GridSelectionInputs extends GridFocusInputs {}\n\n/** Dependencies for the `GridSelection` class. */\ninterface GridSelectionDeps<T extends GridSelectionCell> {\n  /** The `GridData` instance that this selection manager operates on. */\n  grid: GridData<T>;\n\n  /** The `GridFocus` instance that this selection manager uses to manage focus. */\n  gridFocus: GridFocus<T>;\n}\n\n/** Controls selection for a grid of items. */\nexport class GridSelection<T extends GridSelectionCell> {\n  /** The list of cells that were changed in the last selection operation. */\n  private readonly _undoList: WritableSignalLike<[T, boolean][]> = signal([]);\n\n  constructor(readonly inputs: GridSelectionInputs & GridSelectionDeps<T>) {}\n\n  /** Reverts the last selection change. */\n  undo(): void {\n    for (const [cell, oldState] of this._undoList()) {\n      cell.selected.set(oldState);\n    }\n    this._undoList.set([]);\n  }\n\n  /** Selects one or more cells in a given range. */\n  select(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, () => true);\n  }\n\n  /** Deselects one or more cells in a given range. */\n  deselect(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, () => false);\n  }\n\n  /** Toggles the selection state of one or more cells in a given range. */\n  toggle(fromCoords: RowCol, toCoords?: RowCol): void {\n    this._updateState(fromCoords, toCoords ?? fromCoords, oldState => !oldState);\n  }\n\n  /** Selects all valid cells in the grid. */\n  selectAll(): void {\n    this._updateState(\n      {row: 0, col: 0},\n      {row: this.inputs.grid.maxRowCount(), col: this.inputs.grid.maxColCount()},\n      () => true,\n    );\n  }\n\n  /** Deselects all valid cells in the grid. */\n  deselectAll(): void {\n    this._updateState(\n      {row: 0, col: 0},\n      {row: this.inputs.grid.maxRowCount(), col: this.inputs.grid.maxColCount()},\n      () => false,\n    );\n  }\n\n  /** Whether a cell is selctable. */\n  isSelectable(cell: T) {\n    return cell.selectable() && !cell.disabled();\n  }\n\n  /** A generator that yields all cells within a given range. */\n  *_validCells(fromCoords: RowCol, toCoords: RowCol): Generator<T> {\n    const startRow = Math.min(fromCoords.row, toCoords.row);\n    const startCol = Math.min(fromCoords.col, toCoords.col);\n    const endRow = Math.max(fromCoords.row, toCoords.row);\n    const endCol = Math.max(fromCoords.col, toCoords.col);\n    const visited = new Set<T>();\n    for (let row = startRow; row < endRow + 1; row++) {\n      for (let col = startCol; col < endCol + 1; col++) {\n        const cell = this.inputs.grid.getCell({row, col});\n        if (cell === undefined) continue;\n        if (!this.isSelectable(cell)) continue;\n        if (visited.has(cell)) continue;\n        visited.add(cell);\n        yield cell;\n      }\n    }\n  }\n\n  /**\n   * Updates the selection state of cells in a given range and preserves previous changes\n   * to a undo list.\n   */\n  private _updateState(\n    fromCoords: RowCol,\n    toCoords: RowCol,\n    stateFn: (oldState: boolean) => boolean,\n  ): void {\n    const undoList: [T, boolean][] = [];\n    for (const cell of this._validCells(fromCoords, toCoords)) {\n      const oldState = cell.selected();\n      undoList.push([cell, oldState]);\n      cell.selected.set(stateFn(oldState));\n    }\n    this._undoList.set(undoList);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, linkedSignal, signal} from '@angular/core';\nimport {GridData, BaseGridCell, GridDataInputs, RowCol} from './grid-data';\nimport {GridFocus, GridFocusCell, GridFocusInputs} from './grid-focus';\nimport {\n  direction,\n  GridNavigation,\n  GridNavigationCell,\n  GridNavigationInputs,\n} from './grid-navigation';\nimport {GridSelectionCell, GridSelectionInputs, GridSelection} from './grid-selection';\nimport {SignalLike} from '../signal-like/signal-like';\n\n/** The selection operations that can be performed after a navigation operation. */\nexport interface NavOptions {\n  /** Toggles the selection state of the active cell. */\n  toggle?: boolean;\n\n  /**\n   * Toggles the selection state of the active cell, and deselects all other cells if the\n   * active cell is selected. If the active cell is the only selected cell, it will be deselected.\n   */\n  toggleOne?: boolean;\n\n  /** Selects the active cell, preserving the selection state of other cells. */\n  select?: boolean;\n\n  /** Deselects all other cells and selects the active cell. */\n  selectOne?: boolean;\n\n  /**\n   * Moves the selection anchor to the active cell and updates the selection to include all\n   * cells between the anchor and the active cell.\n   */\n  anchor?: boolean;\n}\n\n/** A type that represents a cell in a grid, combining all cell-related interfaces. */\nexport type GridCell = BaseGridCell & GridFocusCell & GridNavigationCell & GridSelectionCell;\n\n/** Represents the required inputs for a grid. */\nexport type GridInputs<T extends GridCell> = GridDataInputs<T> &\n  GridFocusInputs &\n  GridNavigationInputs &\n  GridSelectionInputs;\n\n/** The main class that orchestrates the grid behaviors. */\nexport class Grid<T extends GridCell> {\n  /** The underlying data structure for the grid. */\n  readonly data: GridData<T>;\n\n  /** Controls focus for the grid. */\n  readonly focusBehavior: GridFocus<T>;\n\n  /** Controls navigation for the grid. */\n  readonly navigationBehavior: GridNavigation<T>;\n\n  /** Controls selection for the grid. */\n  readonly selectionBehavior: GridSelection<T>;\n\n  /** The anchor point for range selection, linked to the active coordinates. */\n  readonly selectionAnchor = linkedSignal<RowCol>(() => this.focusBehavior.activeCoords());\n\n  /** The cell at the selection anchor. */\n  readonly selectionAnchorCell = computed(() => this.data.getCell(this.selectionAnchor()));\n\n  /** Whether a range selection has settled. */\n  readonly selectionStabled = signal(true);\n\n  /** Whether all selectable cells are selected. */\n  readonly allSelected: SignalLike<boolean> = computed(() =>\n    this.data\n      .cells()\n      .flat()\n      .filter(c => this.selectionBehavior.isSelectable(c))\n      .every(c => c.selected()),\n  );\n\n  /** The tab index for the grid container. */\n  readonly gridTabIndex: SignalLike<-1 | 0> = () => this.focusBehavior.gridTabIndex();\n\n  /** Whether the grid is in a disabled state. */\n  readonly gridDisabled: SignalLike<boolean> = () => this.focusBehavior.gridDisabled();\n\n  /** The ID of the active descendant for ARIA `activedescendant` focus management. */\n  readonly activeDescendant: SignalLike<string | undefined> = () =>\n    this.focusBehavior.activeDescendant();\n\n  constructor(readonly inputs: GridInputs<T>) {\n    this.data = new GridData(inputs);\n    this.focusBehavior = new GridFocus({...inputs, grid: this.data});\n    this.navigationBehavior = new GridNavigation({\n      ...inputs,\n      grid: this.data,\n      gridFocus: this.focusBehavior,\n    });\n    this.selectionBehavior = new GridSelection({\n      ...inputs,\n      grid: this.data,\n      gridFocus: this.focusBehavior,\n    });\n  }\n\n  /** Gets the 1-based row index of a cell. */\n  rowIndex(cell: T): number | undefined {\n    const index = this.data.getCoords(cell)?.row;\n    return index !== undefined ? index + 1 : undefined;\n  }\n\n  /** Gets the 1-based column index of a cell. */\n  colIndex(cell: T): number | undefined {\n    const index = this.data.getCoords(cell)?.col;\n    return index !== undefined ? index + 1 : undefined;\n  }\n\n  /** Gets the tab index for a given cell. */\n  cellTabIndex(cell: T): -1 | 0 {\n    return this.focusBehavior.getCellTabIndex(cell);\n  }\n\n  /** Navigates to the cell above the currently active cell. */\n  up(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Up, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Up),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell below the currently active cell. */\n  down(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Down, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Down),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell to the left of the currently active cell. */\n  left(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Left, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Left),\n      opts,\n    );\n  }\n\n  /** Navigates to the cell to the right of the currently active cell. */\n  right(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() =>\n              this.navigationBehavior.peek(direction.Right, this.selectionAnchor(), 'nowrap', true),\n            )\n          : this.navigationBehavior.advance(direction.Right),\n      opts,\n    );\n  }\n\n  /** Navigates to the first focusable cell in the grid. */\n  first(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekFirst(undefined, true))\n          : this.navigationBehavior.first(),\n      opts,\n    );\n  }\n\n  /** Navigates to the first focusable cell in the current row. */\n  firstInRow(opts: NavOptions = {}): boolean {\n    const row = this.focusBehavior.activeCoords().row;\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekFirst(row, true))\n          : this.navigationBehavior.first(row),\n      opts,\n    );\n  }\n\n  /** Navigates to the last focusable cell in the grid. */\n  last(opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekLast(undefined, true))\n          : this.navigationBehavior.last(),\n      opts,\n    );\n  }\n\n  /** Navigates to the last focusable cell in the current row. */\n  lastInRow(opts: NavOptions = {}): boolean {\n    const row = this.focusBehavior.activeCoords().row;\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.navigationBehavior.peekLast(row, true))\n          : this.navigationBehavior.last(row),\n      opts,\n    );\n  }\n\n  /** Selects all cells in the current row. */\n  selectRow(): void {\n    const row = this.focusBehavior.activeCoords().row;\n    this.selectionBehavior.deselectAll();\n    this.selectionBehavior.select({row, col: 0}, {row, col: this.data.maxColCount()});\n  }\n\n  /** Selects all cells in the current column. */\n  selectCol(): void {\n    const col = this.focusBehavior.activeCoords().col;\n    this.selectionBehavior.deselectAll();\n    this.selectionBehavior.select({row: 0, col}, {row: this.data.maxRowCount(), col});\n  }\n\n  /** Selects the active cell. */\n  select(): void {\n    this.selectionBehavior.select(this.focusBehavior.activeCoords());\n  }\n\n  /** Deselects the active cell. */\n  deselect(): void {\n    this.selectionBehavior.deselect(this.focusBehavior.activeCoords());\n  }\n\n  /**\n   * Toggles the selection state of the coordinates of the given cell\n   * or the current active coordinates.\n   */\n  toggle(): void {\n    this.selectionBehavior.toggle(this.focusBehavior.activeCoords());\n  }\n\n  /** Toggles the selection state of the active cell, and deselects all other cells. */\n  toggleOne(): void {\n    const selected = !!this.focusBehavior.activeCell()?.selected();\n    if (selected) {\n      this.deselect();\n      return;\n    }\n\n    this.deselectAll();\n    this.select();\n  }\n\n  /** Selects all selectable cells in the grid. */\n  selectAll(): void {\n    this.selectionBehavior.selectAll();\n  }\n\n  /** Deselects all cells in the grid. */\n  deselectAll(): void {\n    this.selectionBehavior.deselectAll();\n  }\n\n  /** Navigates to and focuses the given cell. */\n  gotoCell(cell: T, opts: NavOptions = {}): boolean {\n    return this._navigateWithSelection(\n      () =>\n        opts.anchor\n          ? this._updateSelectionAnchor(() => this.data.getCoords(cell))\n          : this.navigationBehavior.gotoCell(cell),\n      opts,\n    );\n  }\n\n  /** Sets the default active state of the grid. */\n  setDefaultState(): boolean {\n    // Try to find a selected cell that's focusable.\n    const focusableSelectedCell: T | undefined = this.data\n      .cells()\n      .flat()\n      .filter(c => this.focusBehavior.isFocusable(c))\n      .find(c => c.selected());\n\n    if (focusableSelectedCell !== undefined) {\n      this.focusBehavior.focusCell(focusableSelectedCell);\n      return true;\n    }\n\n    // Otherwise find the first focusable cell.\n    const firstFocusableCoords = this.navigationBehavior.peekFirst();\n\n    if (firstFocusableCoords !== undefined) {\n      return this.focusBehavior.focusCoordinates(firstFocusableCoords);\n    }\n\n    return false;\n  }\n\n  /** Resets the active state of the grid if it is empty or stale. */\n  resetState(): boolean {\n    if (this.focusBehavior.stateEmpty()) {\n      return this.setDefaultState();\n    }\n\n    if (this.focusBehavior.stateStale()) {\n      // Try focus on the same active cell after if a reordering happened.\n      if (this.focusBehavior.focusCell(this.focusBehavior.activeCell()!)) {\n        return true;\n      }\n\n      // If the active cell is no longer exist, focus on the coordinates instead.\n      if (this.focusBehavior.focusCoordinates(this.focusBehavior.activeCoords())) {\n        return true;\n      }\n\n      // If the cooridnates no longer valid, go back to the first available cell.\n      if (this.focusBehavior.focusCoordinates(this.navigationBehavior.peekFirst()!)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Updates the selection anchor to the given coordinates. */\n  private _updateSelectionAnchor(peekFn: () => RowCol | undefined): boolean {\n    const coords = peekFn();\n    const success = coords !== undefined;\n    if (!success) return false;\n    this.selectionAnchor.set(coords);\n    return success;\n  }\n\n  /** Updates the selection to include all cells between the anchor and the active cell. */\n  private _updateRangeSelection(): void {\n    if (!this.selectionStabled()) {\n      this.selectionBehavior.undo();\n    }\n    this.selectionBehavior.select(\n      ...this._getSelectionCoords(this.focusBehavior.activeCoords(), this.selectionAnchor()),\n    );\n  }\n\n  /** Gets the start and end coordinates for a selection range. */\n  private _getSelectionCoords(startCoords: RowCol, endCoords: RowCol): [RowCol, RowCol] {\n    const startCell = this.data.getCell(startCoords)!;\n    const endCell = this.data.getCell(endCoords)!;\n    const allCoords = [...this.data.getAllCoords(startCell)!, ...this.data.getAllCoords(endCell)!];\n    const allRows = allCoords.map(c => c.row);\n    const allCols = allCoords.map(c => c.col);\n    const fromCoords = {\n      row: Math.min(...allRows),\n      col: Math.min(...allCols),\n    };\n    const toCoords = {\n      row: Math.max(...allRows),\n      col: Math.max(...allCols),\n    };\n\n    return [fromCoords, toCoords];\n  }\n\n  /** Executes a navigation operation and applies selection options. */\n  private _navigateWithSelection(op: () => boolean, opts: NavOptions = {}): boolean {\n    const success = op();\n    if (!success) return false;\n\n    if (opts.anchor) {\n      this._updateRangeSelection();\n      this.selectionStabled.set(false);\n      return success;\n    }\n\n    // Selection becomes stable after the active cell/coords moved.\n    this.selectionStabled.set(true);\n\n    if (opts.select) {\n      this.select();\n      return success;\n    }\n\n    if (opts.selectOne) {\n      this.deselectAll();\n      this.select();\n      return success;\n    }\n\n    if (opts.toggle) {\n      this.toggle();\n      return success;\n    }\n\n    if (opts.toggleOne) {\n      const selected = !!this.focusBehavior.activeCell()?.selected();\n      this.deselectAll();\n      if (!selected) {\n        this.select();\n      }\n      return success;\n    }\n\n    return success;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport {KeyboardEventManager, PointerEventManager, Modifier} from '../behaviors/event-manager';\nimport {NavOptions, Grid, GridInputs as GridBehaviorInputs} from '../behaviors/grid';\nimport type {GridRowPattern} from './row';\nimport type {GridCellPattern} from './cell';\n\n/** Represents the required inputs for the grid pattern. */\nexport interface GridInputs extends Omit<GridBehaviorInputs<GridCellPattern>, 'cells'> {\n  /** The html element of the grid. */\n  element: SignalLike<HTMLElement>;\n\n  /** The rows that make up the grid. */\n  rows: SignalLike<GridRowPattern[]>;\n\n  /** The direction that text is read based on the users locale. */\n  textDirection: SignalLike<'rtl' | 'ltr'>;\n\n  /** Whether selection is enabled for the grid. */\n  enableSelection: SignalLike<boolean>;\n\n  /** Whether multiple cell in the grid can be selected. */\n  multi: SignalLike<boolean>;\n\n  /** The selection strategy used by the grid. */\n  selectionMode: SignalLike<'follow' | 'explicit'>;\n\n  /** Whether enable range selection. */\n  enableRangeSelection: SignalLike<boolean>;\n\n  /** A function that returns the grid cell associated with a given element. */\n  getCell: (e: Element) => GridCellPattern | undefined;\n}\n\n/** The UI pattern for a grid, handling keyboard navigation, focus, and selection. */\nexport class GridPattern {\n  /** The underlying grid behavior that this pattern is built on. */\n  readonly gridBehavior: Grid<GridCellPattern>;\n\n  /** The cells in the grid. */\n  readonly cells = computed(() => this.gridBehavior.data.cells());\n\n  /** The tab index for the grid. */\n  readonly tabIndex = computed(() => this.gridBehavior.gridTabIndex());\n\n  /** Whether the grid is disabled. */\n  readonly disabled = computed(() => this.gridBehavior.gridDisabled());\n\n  /** The ID of the currently active descendant cell. */\n  readonly activeDescendant = computed(() => this.gridBehavior.activeDescendant());\n\n  /** The currently active cell. */\n  readonly activeCell = computed(() => this.gridBehavior.focusBehavior.activeCell());\n\n  /** The current selection anchor cell. */\n  readonly anchorCell: SignalLike<GridCellPattern | undefined> = computed(() =>\n    this.inputs.enableSelection() && this.inputs.multi()\n      ? this.gridBehavior.selectionAnchorCell()\n      : undefined,\n  );\n\n  /** Whether to pause grid navigation. */\n  readonly pauseNavigation = computed(() =>\n    this.gridBehavior.data\n      .cells()\n      .flat()\n      .reduce((res, c) => res || c.widgetActivated(), false),\n  );\n\n  /** Whether the focus is in the grid. */\n  readonly isFocused = signal(false);\n\n  /** Whether the grid has been focused once. */\n  readonly hasBeenFocused = signal(false);\n\n  /** Whether the user is currently dragging to select a range of cells. */\n  readonly dragging = signal(false);\n\n  /** The key for navigating to the previous column. */\n  readonly prevColKey = computed(() =>\n    this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft',\n  );\n\n  /** The key for navigating to the next column. */\n  readonly nextColKey = computed(() =>\n    this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight',\n  );\n\n  /** The keydown event manager for the grid. */\n  readonly keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    if (this.pauseNavigation()) {\n      return manager;\n    }\n\n    // Navigation handlers.\n    const opts: NavOptions = {\n      selectOne: this.inputs.enableSelection() && this.inputs.selectionMode() === 'follow',\n    };\n    manager\n      .on('ArrowUp', () => this.gridBehavior.up(opts))\n      .on('ArrowDown', () => this.gridBehavior.down(opts))\n      .on(this.prevColKey(), () => this.gridBehavior.left(opts))\n      .on(this.nextColKey(), () => this.gridBehavior.right(opts))\n      .on('Home', () => this.gridBehavior.firstInRow(opts))\n      .on('End', () => this.gridBehavior.lastInRow(opts))\n      .on([Modifier.Ctrl], 'Home', () => this.gridBehavior.first(opts))\n      .on([Modifier.Ctrl], 'End', () => this.gridBehavior.last(opts));\n\n    // Basic explicit selection handlers.\n    if (this.inputs.enableSelection() && this.inputs.selectionMode() === 'explicit') {\n      manager\n        .on('Enter', () =>\n          this.inputs.multi() ? this.gridBehavior.toggle() : this.gridBehavior.toggleOne(),\n        )\n        .on(' ', () =>\n          this.inputs.multi() ? this.gridBehavior.toggle() : this.gridBehavior.toggleOne(),\n        );\n    }\n\n    // Range selection handlers.\n    if (this.inputs.enableSelection() && this.inputs.enableRangeSelection()) {\n      manager\n        .on(Modifier.Shift, 'ArrowUp', () => this.gridBehavior.up({anchor: true}))\n        .on(Modifier.Shift, 'ArrowDown', () => this.gridBehavior.down({anchor: true}))\n        .on(Modifier.Shift, this.prevColKey(), () => this.gridBehavior.left({anchor: true}))\n        .on(Modifier.Shift, this.nextColKey(), () => this.gridBehavior.right({anchor: true}))\n        .on(Modifier.Shift, 'Home', () => this.gridBehavior.firstInRow({anchor: true}))\n        .on(Modifier.Shift, 'End', () => this.gridBehavior.lastInRow({anchor: true}))\n        .on([Modifier.Ctrl | Modifier.Shift], 'Home', () => this.gridBehavior.first({anchor: true}))\n        .on([Modifier.Ctrl | Modifier.Shift], 'End', () => this.gridBehavior.last({anchor: true}))\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => {\n          if (this.gridBehavior.allSelected()) {\n            this.gridBehavior.deselectAll();\n          } else {\n            this.gridBehavior.selectAll();\n          }\n        })\n        .on([Modifier.Shift], ' ', () => this.gridBehavior.selectRow())\n        .on([Modifier.Ctrl, Modifier.Meta], ' ', () => this.gridBehavior.selectCol());\n    }\n\n    return manager;\n  });\n\n  /** The pointerdown event manager for the grid. */\n  readonly pointerdown = computed(() => {\n    const manager = new PointerEventManager();\n\n    // Navigation without selection.\n    if (!this.inputs.enableSelection()) {\n      manager.on(e => {\n        const cell = this.inputs.getCell(e.target as Element);\n        if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n        this.gridBehavior.gotoCell(cell);\n      });\n    }\n\n    // Navigation with selection.\n    if (this.inputs.enableSelection()) {\n      manager.on(e => {\n        const cell = this.inputs.getCell(e.target as Element);\n        if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n        this.gridBehavior.gotoCell(cell, {\n          selectOne: this.inputs.selectionMode() === 'follow',\n          toggleOne: this.inputs.selectionMode() === 'explicit' && !this.inputs.multi(),\n          toggle: this.inputs.selectionMode() === 'explicit' && this.inputs.multi(),\n        });\n\n        if (this.inputs.multi() && this.inputs.enableRangeSelection()) {\n          this.dragging.set(true);\n        }\n      });\n\n      // Selection with modifier keys.\n      if (this.inputs.multi()) {\n        manager.on([Modifier.Ctrl, Modifier.Meta], e => {\n          const cell = this.inputs.getCell(e.target as Element);\n          if (!cell || !this.gridBehavior.focusBehavior.isFocusable(cell)) return;\n\n          this.gridBehavior.gotoCell(cell, {toggle: true});\n\n          if (this.inputs.enableRangeSelection()) {\n            this.dragging.set(true);\n          }\n        });\n\n        if (this.inputs.enableRangeSelection()) {\n          manager.on(Modifier.Shift, e => {\n            const cell = this.inputs.getCell(e.target as Element);\n            if (!cell) return;\n\n            this.gridBehavior.gotoCell(cell, {anchor: true});\n            this.dragging.set(true);\n          });\n        }\n      }\n    }\n\n    return manager;\n  });\n\n  /** The pointerup event manager for the grid. */\n  readonly pointerup = computed(() => {\n    const manager = new PointerEventManager();\n\n    if (this.inputs.enableSelection() && this.inputs.enableRangeSelection()) {\n      manager.on([Modifier.Shift, Modifier.Ctrl, Modifier.Meta, Modifier.None], () => {\n        this.dragging.set(false);\n      });\n    }\n\n    return manager;\n  });\n\n  /** Indicates maybe the losing focus is caused by row/cell deletion. */\n  private readonly _maybeDeletion = signal(false);\n\n  /** Indicates the losing focus is certainly caused by row/cell deletion. */\n  private readonly _deletion = signal(false);\n\n  constructor(readonly inputs: GridInputs) {\n    this.gridBehavior = new Grid({\n      ...inputs,\n      cells: computed(() => this.inputs.rows().map(row => row.inputs.cells())),\n    });\n  }\n\n  /** Handles keydown events on the grid. */\n  onKeydown(event: KeyboardEvent) {\n    if (!this.disabled()) {\n      this.keydown().handle(event);\n    }\n  }\n\n  /** Handles pointerdown events on the grid. */\n  onPointerdown(event: PointerEvent) {\n    if (!this.disabled()) {\n      this.pointerdown().handle(event);\n    }\n  }\n\n  /** Handles pointermove events on the grid. */\n  onPointermove(event: PointerEvent) {\n    if (this.disabled()) return;\n    if (!this.inputs.enableSelection()) return;\n    if (!this.inputs.enableRangeSelection()) return;\n    if (!this.dragging()) return;\n\n    const cell = this.inputs.getCell(event.target as Element);\n    if (!cell) return;\n\n    this.gridBehavior.gotoCell(cell, {anchor: true});\n  }\n\n  /** Handles pointerup events on the grid. */\n  onPointerup(event: PointerEvent) {\n    if (!this.disabled()) {\n      this.pointerup().handle(event);\n    }\n  }\n\n  /** Handles focusin events on the grid. */\n  onFocusIn() {\n    this.isFocused.set(true);\n    this.hasBeenFocused.set(true);\n  }\n\n  /** Handles focusout events on the grid. */\n  onFocusOut(event: FocusEvent) {\n    const parentEl = this.inputs.element();\n    const targetEl = event.relatedTarget as Node | null;\n\n    // If a `relatedTarget` is null, then it can be caused by either\n    // - Clicking on a non-focusable element, or\n    // - The focused element is removed from the page.\n    if (targetEl === null) {\n      this._maybeDeletion.set(true);\n    }\n\n    if (parentEl.contains(targetEl)) return;\n    this.isFocused.set(false);\n  }\n\n  /** Sets the default active state of the grid before receiving focus the first time. */\n  setDefaultStateEffect(): void {\n    if (this.hasBeenFocused()) return;\n\n    this.gridBehavior.setDefaultState();\n  }\n\n  /** Resets the active state of the grid if it is empty or stale. */\n  resetStateEffect(): void {\n    const hasReset = this.gridBehavior.resetState();\n\n    // If the active state has been reset right after a focusout event, then\n    // we know it's caused by a row/cell deletion.\n    if (hasReset && this._maybeDeletion()) {\n      this._deletion.set(true);\n    }\n    // Reset maybe deletion state.\n    this._maybeDeletion.set(false);\n  }\n\n  /** Focuses on the active cell element. */\n  focusEffect(): void {\n    const activeCell = this.activeCell();\n    const hasFocus = this.isFocused();\n    const deletion = this._deletion();\n    const isRoving = this.inputs.focusMode() === 'roving';\n    if (activeCell !== undefined && isRoving && (hasFocus || deletion)) {\n      activeCell.element().focus();\n\n      if (deletion) {\n        this._deletion.set(false);\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport type {GridPattern} from './grid';\nimport type {GridCellPattern} from './cell';\n\n/** The inputs for the `GridRowPattern`. */\nexport interface GridRowInputs {\n  /** The `GridPattern` that this row belongs to. */\n  grid: SignalLike<GridPattern>;\n\n  /** The cells that make up this row. */\n  cells: SignalLike<GridCellPattern[]>;\n\n  /** The index of this row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n}\n\n/** The UI pattern for a grid row. */\nexport class GridRowPattern {\n  /** The index of this row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n\n  constructor(readonly inputs: GridRowInputs) {\n    this.rowIndex = inputs.rowIndex;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike, WritableSignalLike} from '../behaviors/signal-like/signal-like';\nimport {GridCell} from '../behaviors/grid';\nimport type {GridPattern} from './grid';\nimport type {GridRowPattern} from './row';\nimport type {GridCellWidgetPattern} from './widget';\n\n/** The inputs for the `GridCellPattern`. */\nexport interface GridCellInputs extends GridCell {\n  /** The `GridPattern` that this cell belongs to. */\n  grid: SignalLike<GridPattern>;\n\n  /** The `GridRowPattern` that this cell belongs to. */\n  row: SignalLike<GridRowPattern>;\n\n  /** The widget pattern contained within this cell, if any. */\n  widget: SignalLike<GridCellWidgetPattern | undefined>;\n\n  /** The index of this cell's row within the grid. */\n  rowIndex: SignalLike<number | undefined>;\n\n  /** The index of this cell's column within the grid. */\n  colIndex: SignalLike<number | undefined>;\n}\n\n/** The UI pattern for a grid cell. */\nexport class GridCellPattern implements GridCell {\n  /** A unique identifier for the cell. */\n  readonly id: SignalLike<string>;\n\n  /** Whether a cell is disabled. */\n  readonly disabled: SignalLike<boolean>;\n\n  /** Whether the cell is selected. */\n  readonly selected: WritableSignalLike<boolean>;\n\n  /** Whether the cell is selectable. */\n  readonly selectable: SignalLike<boolean>;\n\n  /** The number of rows the cell should span. */\n  readonly rowSpan: SignalLike<number>;\n\n  /** The number of columns the cell should span. */\n  readonly colSpan: SignalLike<number>;\n\n  /** The `aria-selected` attribute for the cell. */\n  readonly ariaSelected = computed<boolean | undefined>(() =>\n    this.inputs.grid().inputs.enableSelection() && this.selectable() ? this.selected() : undefined,\n  );\n\n  /** The `aria-rowindex` attribute for the cell. */\n  readonly ariaRowIndex = computed(\n    () =>\n      this.inputs.row().rowIndex() ??\n      this.inputs.rowIndex() ??\n      this.inputs.grid().gridBehavior.rowIndex(this),\n  );\n\n  /** The `aria-colindex` attribute for the cell. */\n  readonly ariaColIndex = computed(\n    () => this.inputs.colIndex() ?? this.inputs.grid().gridBehavior.colIndex(this),\n  );\n\n  /** The html element that should receive focus. */\n  readonly element: SignalLike<HTMLElement> = computed(\n    () => this.inputs.widget()?.element() ?? this.inputs.element(),\n  );\n\n  /** Whether the cell is active. */\n  readonly active = computed(() => this.inputs.grid().activeCell() === this);\n\n  /** Whether the cell is a selection anchor. */\n  readonly anchor: SignalLike<true | undefined> = computed(() =>\n    this.inputs.grid().anchorCell() === this ? true : undefined,\n  );\n\n  /** The internal tab index calculation for the cell. */\n  private readonly _tabIndex: SignalLike<-1 | 0> = computed(() =>\n    this.inputs.grid().gridBehavior.cellTabIndex(this),\n  );\n\n  /** The tab index for the cell. If the cell contains a widget, the cell's tab index is -1. */\n  readonly tabIndex: SignalLike<-1 | 0> = computed(() =>\n    this.inputs.widget() !== undefined ? -1 : this._tabIndex(),\n  );\n\n  /** Whether the widget within the cell is activated. */\n  readonly widgetActivated: SignalLike<boolean> = computed(\n    () => this.inputs.widget()?.inputs.activate() ?? false,\n  );\n\n  constructor(readonly inputs: GridCellInputs) {\n    this.id = inputs.id;\n    this.disabled = inputs.disabled;\n    this.rowSpan = inputs.rowSpan;\n    this.colSpan = inputs.colSpan;\n    this.selected = inputs.selected;\n    this.selectable = inputs.selectable;\n  }\n\n  /** Gets the tab index for the widget within the cell. */\n  widgetTabIndex(): -1 | 0 {\n    return this._tabIndex();\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike, WritableSignalLike} from '../behaviors/signal-like/signal-like';\nimport type {GridCellPattern} from './cell';\n\n/** The inputs for the `GridCellWidgetPattern`. */\nexport interface GridCellWidgetInputs {\n  /** The `GridCellPattern` that this widget belongs to. */\n  cell: SignalLike<GridCellPattern>;\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement>;\n\n  /**\n   * Whether the widget is activated, which pauses grid navigation to allow interaction\n   * with the widget.\n   */\n  activate: WritableSignalLike<boolean>;\n}\n\n/** The UI pattern for a widget inside a grid cell. */\nexport class GridCellWidgetPattern {\n  /** The html element that should receive focus. */\n  readonly element: SignalLike<HTMLElement>;\n\n  /** The `tab index` for the widget. */\n  readonly tabIndex: SignalLike<-1 | 0> = computed(() => this.inputs.cell().widgetTabIndex());\n\n  /** Whether the widget is in an active state (i.e. its containing cell is active). */\n  readonly active: SignalLike<boolean> = computed(() => this.inputs.cell().active());\n\n  constructor(readonly inputs: GridCellWidgetInputs) {\n    this.element = inputs.element;\n  }\n}\n"],"names":["Modifier","EventManager","configs","handle","event","config","matcher","handler","preventDefault","stopPropagation","getModifiers","ctrlKey","Ctrl","shiftKey","Shift","altKey","Alt","metaKey","Meta","hasModifiers","modifiers","eventModifiers","modifiersList","Array","isArray","includes","Any","some","KeyboardEventManager","options","on","args","key","_normalizeInputs","push","_isMatch","withModifiers","None","RegExp","test","keyStr","toLowerCase","MouseButton","PointerEventManager","button","length","Main","GridData","inputs","cells","maxRowCount","computed","Math","max","_rowCountByCol","values","maxColCount","_colCountsByRow","_coordsMap","coordsMap","Map","visitedCoords","Set","rowIndex","colIndex","row","cell","has","rowspan","rowSpan","colspan","colSpan","spanCoords","rowOffset","colOffset","col","add","set","coords","_cellMap","cellMap","entries","colCountByRow","_","colCount","get","newColCount","undefined","rowCountByCol","rowCount","newRowCount","constructor","getCell","rowCol","getCoords","getAllCoords","getRowCount","getColCount","GridFocus","activeCell","signal","activeCoords","stateEmpty","stateStale","activeCellCoords","grid","activeCoordsCell","activeCellNotValid","activeCellMismatch","activeDescendant","gridDisabled","focusMode","currentActiveCell","id","disabled","gridCells","every","gridTabIndex","getCellTabIndex","isFocusable","softDisabled","focusCell","focusCoordinates","direction","Up","Down","Left","Right","GridNavigation","_maxSteps","gotoCell","gridFocus","gotoCoords","peek","fromCoords","wrap","allowDisabled","rowWrap","colWrap","_peekDirectional","advance","nextCoords","peekFirst","first","peekLast","last","delta","fromCell","rowDelta","colDelta","step","isWrapping","generalDelta","rowStep","colStep","nextCell","GridSelection","_undoList","undo","oldState","selected","select","toCoords","_updateState","deselect","toggle","selectAll","deselectAll","isSelectable","selectable","_validCells","startRow","min","startCol","endRow","endCol","visited","stateFn","undoList","Grid","data","focusBehavior","navigationBehavior","selectionBehavior","selectionAnchor","linkedSignal","selectionAnchorCell","selectionStabled","allSelected","flat","filter","c","index","cellTabIndex","up","opts","_navigateWithSelection","anchor","_updateSelectionAnchor","down","left","right","firstInRow","lastInRow","selectRow","selectCol","toggleOne","setDefaultState","focusableSelectedCell","find","firstFocusableCoords","resetState","peekFn","success","_updateRangeSelection","_getSelectionCoords","startCoords","endCoords","startCell","endCell","allCoords","allRows","map","allCols","op","selectOne","GridPattern","gridBehavior","tabIndex","anchorCell","enableSelection","multi","pauseNavigation","reduce","res","widgetActivated","isFocused","hasBeenFocused","dragging","prevColKey","textDirection","nextColKey","keydown","manager","selectionMode","enableRangeSelection","pointerdown","e","target","pointerup","_maybeDeletion","_deletion","rows","onKeydown","onPointerdown","onPointermove","onPointerup","onFocusIn","onFocusOut","parentEl","element","targetEl","relatedTarget","contains","setDefaultStateEffect","resetStateEffect","hasReset","focusEffect","hasFocus","deletion","isRoving","focus","GridRowPattern","GridCellPattern","ariaSelected","ariaRowIndex","ariaColIndex","widget","active","_tabIndex","activate","widgetTabIndex","GridCellWidgetPattern"],"mappings":"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"}