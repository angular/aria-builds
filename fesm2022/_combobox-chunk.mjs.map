{"version":3,"file":"_combobox-chunk.mjs","sources":["../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/combobox/combobox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {KeyboardEventManager, PointerEventManager} from '../behaviors/event-manager';\nimport {\n  computed,\n  signal,\n  SignalLike,\n  WritableSignalLike,\n} from '../behaviors/signal-like/signal-like';\nimport {ListItem} from '../behaviors/list/list';\n\n/** Represents the required inputs for a combobox. */\nexport interface ComboboxInputs<T extends ListItem<V>, V> {\n  /** The controls for the popup associated with the combobox. */\n  popupControls: SignalLike<\n    ComboboxListboxControls<T, V> | ComboboxTreeControls<T, V> | ComboboxDialogPattern | undefined\n  >;\n\n  /** The HTML input element that serves as the combobox input. */\n  inputEl: SignalLike<HTMLInputElement | undefined>;\n\n  /** The HTML element that serves as the combobox container. */\n  containerEl: SignalLike<HTMLElement | undefined>;\n\n  /** The filtering mode for the combobox. */\n  filterMode: SignalLike<'manual' | 'auto-select' | 'highlight'>;\n\n  /** The current value of the combobox. */\n  inputValue?: WritableSignalLike<string>;\n\n  /** The value of the first matching item in the popup. */\n  firstMatch: SignalLike<V | undefined>;\n\n  /** Whether the combobox is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** Whether the combobox is read-only. */\n  readonly: SignalLike<boolean>;\n\n  /** Whether the combobox is in a right-to-left context. */\n  textDirection: SignalLike<'rtl' | 'ltr'>;\n\n  /** Whether the combobox is always expanded. */\n  alwaysExpanded: SignalLike<boolean>;\n}\n\n/** An interface that allows combobox popups to expose the necessary controls for the combobox. */\nexport interface ComboboxListboxControls<T extends ListItem<V>, V> {\n  /** A unique identifier for the popup. */\n  id: () => string;\n\n  /** The ARIA role for the popup. */\n  role: SignalLike<'listbox' | 'tree' | 'grid'>;\n\n  // TODO(wagnermaciel): Add validation that ensures only readonly comboboxes can have multi-select popups.\n\n  /** Whether multiple items in the popup can be selected at once. */\n  multi: SignalLike<boolean>;\n\n  /** The ID of the active item in the popup. */\n  activeId: SignalLike<string | undefined>;\n\n  /** The list of items in the popup. */\n  items: SignalLike<T[]>;\n\n  /** Navigates to the given item in the popup. */\n  focus: (item: T, opts?: {focusElement?: boolean}) => void;\n\n  /** Navigates to the next item in the popup. */\n  next: () => void;\n\n  /** Navigates to the previous item in the popup. */\n  prev: () => void;\n\n  /** Navigates to the first item in the popup. */\n  first: () => void;\n\n  /** Navigates to the last item in the popup. */\n  last: () => void;\n\n  /** Selects the current item in the popup. */\n  select: (item?: T) => void;\n\n  /** Toggles the selection state of the given item in the popup. */\n  toggle: (item?: T) => void;\n\n  /** Clears the selection state of the popup. */\n  clearSelection: () => void;\n\n  /** Removes focus from any item in the popup. */\n  unfocus: () => void;\n\n  /** Returns the item corresponding to the given event. */\n  getItem: (e: PointerEvent) => T | undefined;\n\n  /** Returns the currently active (focused) item in the popup. */\n  getActiveItem: () => T | undefined;\n\n  /** Returns the currently selected items in the popup. */\n  getSelectedItems: () => T[];\n\n  /** Sets the value of the combobox based on the selected item. */\n  setValue: (value: V | undefined) => void; // For re-setting the value if the popup was destroyed.\n}\n\nexport interface ComboboxTreeControls<T extends ListItem<V>, V> extends ComboboxListboxControls<\n  T,\n  V\n> {\n  /** Whether the currently active item in the popup is collapsible. */\n  isItemCollapsible: () => boolean;\n\n  /** Expands the currently active item in the popup. */\n  expandItem: () => void;\n\n  /** Collapses the currently active item in the popup. */\n  collapseItem: () => void;\n\n  /** Checks if the currently active item in the popup is expandable. */\n  isItemExpandable: (item?: T) => boolean;\n\n  /** Expands all nodes in the tree. */\n  expandAll: () => void;\n\n  /** Collapses all nodes in the tree. */\n  collapseAll: () => void;\n\n  /** Toggles the expansion state of the currently active item in the popup. */\n  toggleExpansion: (item?: T) => void;\n\n  /** Whether the current active item is selectable. */\n  isItemSelectable: (item?: T) => boolean;\n}\n\n/** Controls the state of a combobox. */\nexport class ComboboxPattern<T extends ListItem<V>, V> {\n  /** Whether the combobox is expanded. */\n  expanded = signal(false);\n\n  /** Whether the combobox is disabled. */\n  disabled = () => this.inputs.disabled();\n\n  /** The ID of the active item in the combobox. */\n  activeDescendant = computed(() => {\n    const popupControls = this.inputs.popupControls();\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return null;\n    }\n\n    return popupControls?.activeId() ?? null;\n  });\n\n  /** The currently highlighted item in the combobox. */\n  highlightedItem = signal<T | undefined>(undefined);\n\n  /** Whether the most recent input event was a deletion. */\n  isDeleting = false;\n\n  /** Whether the combobox is focused. */\n  isFocused = signal(false);\n\n  /** Whether the combobox has ever been focused. */\n  hasBeenFocused = signal(false);\n\n  /** The key used to navigate to the previous item in the list. */\n  expandKey = computed(() => (this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight'));\n\n  /** The key used to navigate to the next item in the list. */\n  collapseKey = computed(() =>\n    this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft',\n  );\n\n  /** The ID of the popup associated with the combobox. */\n  popupId = computed(() => this.inputs.popupControls()?.id() || null);\n\n  /** The autocomplete behavior of the combobox. */\n  autocomplete = computed(() => (this.inputs.filterMode() === 'highlight' ? 'both' : 'list'));\n\n  /** The ARIA role of the popup associated with the combobox. */\n  hasPopup = computed(() => this.inputs.popupControls()?.role() || null);\n\n  /** Whether the combobox is read-only. */\n  readonly = computed(() => this.inputs.readonly() || this.inputs.disabled() || null);\n\n  /** Returns the listbox controls for the combobox. */\n  listControls = () => {\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return null;\n    }\n\n    return popupControls;\n  };\n\n  /** Returns the tree controls for the combobox. */\n  treeControls = () => {\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls?.role() === 'tree') {\n      return popupControls as ComboboxTreeControls<T, V>;\n    }\n\n    return null;\n  };\n\n  /** The keydown event manager for the combobox. */\n  keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n    const popupControls = this.inputs.popupControls();\n\n    if (!popupControls) {\n      return manager;\n    }\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      if (!this.expanded()) {\n        manager.on('ArrowUp', () => this.open()).on('ArrowDown', () => this.open());\n\n        if (this.readonly()) {\n          manager.on('Enter', () => this.open()).on(' ', () => this.open());\n        }\n      }\n\n      return manager;\n    }\n\n    if (!this.inputs.alwaysExpanded()) {\n      manager.on('Escape', () => this.close({reset: !this.readonly()}));\n    }\n\n    if (!this.expanded()) {\n      manager\n        .on('ArrowDown', () => this.open({first: true}))\n        .on('ArrowUp', () => this.open({last: true}));\n\n      if (this.readonly()) {\n        manager\n          .on('Enter', () => this.open({selected: true}))\n          .on(' ', () => this.open({selected: true}));\n      }\n\n      return manager;\n    }\n\n    manager\n      .on('ArrowDown', () => this.next(), {ignoreRepeat: false})\n      .on('ArrowUp', () => this.prev(), {ignoreRepeat: false})\n      .on('Home', () => this.first())\n      .on('End', () => this.last());\n\n    if (this.readonly()) {\n      manager.on(' ', () => this.select({commit: true, close: !popupControls.multi()}));\n    }\n\n    if (popupControls.role() === 'listbox') {\n      manager.on('Enter', () => {\n        this.select({commit: true, close: !popupControls.multi()});\n      });\n    }\n\n    const treeControls = this.treeControls();\n\n    if (treeControls?.isItemSelectable()) {\n      manager.on('Enter', () => this.select({commit: true, close: true}));\n    }\n\n    if (treeControls?.isItemExpandable()) {\n      manager\n        .on(this.expandKey(), () => this.expandItem())\n        .on(this.collapseKey(), () => this.collapseItem());\n\n      if (!treeControls.isItemSelectable()) {\n        manager.on('Enter', () => this.expandItem());\n      }\n    }\n\n    if (treeControls?.isItemCollapsible()) {\n      manager.on(this.collapseKey(), () => this.collapseItem());\n    }\n\n    return manager;\n  });\n\n  /** The click event manager for the combobox. */\n  click = computed(() =>\n    new PointerEventManager().on(e => {\n      if (e.target === this.inputs.inputEl()) {\n        if (this.readonly()) {\n          this.expanded() ? this.close() : this.open({selected: true});\n        }\n      }\n\n      const controls = this.inputs.popupControls();\n\n      if (controls instanceof ComboboxDialogPattern) {\n        return;\n      }\n\n      const item = controls?.getItem(e);\n\n      if (item) {\n        if (controls?.role() === 'tree') {\n          const treeControls = controls as ComboboxTreeControls<T, V>;\n\n          if (treeControls.isItemExpandable(item) && !treeControls.isItemSelectable(item)) {\n            treeControls.toggleExpansion(item);\n            this.inputs.inputEl()?.focus();\n            return;\n          }\n        }\n\n        this.select({item, commit: true, close: !controls?.multi()});\n        this.inputs.inputEl()?.focus(); // Return focus to the input after selecting.\n      }\n    }),\n  );\n\n  constructor(readonly inputs: ComboboxInputs<T, V>) {}\n\n  /** Handles keydown events for the combobox. */\n  onKeydown(event: KeyboardEvent) {\n    if (!this.inputs.disabled()) {\n      this.keydown().handle(event);\n    }\n  }\n\n  /** Handles click events for the combobox. */\n  onClick(event: MouseEvent) {\n    if (!this.inputs.disabled()) {\n      this.click().handle(event as PointerEvent);\n    }\n  }\n\n  /** Handles input events for the combobox. */\n  onInput(event: Event) {\n    if (this.inputs.disabled() || this.inputs.readonly()) {\n      return;\n    }\n\n    const inputEl = this.inputs.inputEl();\n\n    if (!inputEl) {\n      return;\n    }\n\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return;\n    }\n\n    this.open();\n    this.inputs.inputValue?.set(inputEl.value);\n    this.isDeleting = event instanceof InputEvent && !!event.inputType.match(/^delete/);\n\n    if (this.inputs.filterMode() === 'highlight' && !this.isDeleting) {\n      this.highlight();\n    }\n  }\n\n  /** Handles focus in events for the combobox. */\n  onFocusIn() {\n    if (this.inputs.alwaysExpanded() && !this.hasBeenFocused()) {\n      const firstSelectedItem = this.listControls()?.getSelectedItems()[0];\n      firstSelectedItem ? this.listControls()?.focus(firstSelectedItem) : this.first();\n    }\n\n    this.isFocused.set(true);\n    this.hasBeenFocused.set(true);\n  }\n\n  /** Handles focus out events for the combobox. */\n  onFocusOut(event: FocusEvent) {\n    if (this.inputs.disabled()) {\n      return;\n    }\n\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return;\n    }\n\n    if (\n      !(event.relatedTarget instanceof HTMLElement) ||\n      !this.inputs.containerEl()?.contains(event.relatedTarget)\n    ) {\n      this.isFocused.set(false);\n\n      if (!this.expanded()) {\n        return;\n      }\n\n      if (this.readonly()) {\n        this.close();\n        return;\n      }\n\n      if (this.inputs.filterMode() !== 'manual') {\n        this.commit();\n      } else {\n        const item = popupControls\n          ?.items()\n          .find(i => i.searchTerm() === this.inputs.inputEl()?.value);\n\n        if (item) {\n          this.select({item});\n        }\n      }\n\n      this.close();\n    }\n  }\n\n  /** The first matching item in the combobox. */\n  firstMatch = computed(() => {\n    // TODO(wagnermaciel): Consider whether we should not provide this default behavior for the\n    // listbox. Instead, we may want to allow users to have no match so that typing does not focus\n    // any option.\n    if (this.listControls()?.role() === 'listbox') {\n      return this.listControls()?.items()[0];\n    }\n\n    return this.listControls()\n      ?.items()\n      .find(i => i.value() === this.inputs.firstMatch());\n  });\n\n  /** Handles filtering logic for the combobox. */\n  onFilter() {\n    if (this.readonly()) {\n      return;\n    }\n\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return;\n    }\n\n    // TODO(wagnermaciel)\n    // When the user first interacts with the combobox, the popup will lazily render for the first\n    // time. This is a simple way to detect this and avoid auto-focus & selection logic, but this\n    // should probably be moved to the component layer instead.\n    const isInitialRender = !this.inputs.inputValue?.().length && !this.isDeleting;\n\n    if (isInitialRender) {\n      return;\n    }\n\n    // Avoid refocusing the input if a filter event occurs after focus has left the combobox.\n    if (!this.isFocused()) {\n      return;\n    }\n\n    if (this.inputs.popupControls()?.role() === 'tree') {\n      const treeControls = this.inputs.popupControls() as ComboboxTreeControls<T, V>;\n      this.inputs.inputValue?.().length ? treeControls.expandAll() : treeControls.collapseAll();\n    }\n\n    const item = this.firstMatch();\n\n    if (!item) {\n      popupControls?.clearSelection();\n      popupControls?.unfocus();\n      return;\n    }\n\n    popupControls?.focus(item);\n\n    if (this.inputs.filterMode() !== 'manual') {\n      this.select({item});\n    }\n\n    if (this.inputs.filterMode() === 'highlight' && !this.isDeleting) {\n      this.highlight();\n    }\n  }\n\n  /** Highlights the currently selected item in the combobox. */\n  highlight() {\n    const inputEl = this.inputs.inputEl();\n    const selectedItems = this.listControls()?.getSelectedItems();\n    const item = selectedItems?.[0];\n\n    if (!inputEl || !item) {\n      return;\n    }\n\n    const isHighlightable = item\n      .searchTerm()\n      .toLowerCase()\n      .startsWith(this.inputs.inputValue!().toLowerCase());\n\n    if (isHighlightable) {\n      inputEl.value =\n        this.inputs.inputValue!() + item.searchTerm().slice(this.inputs.inputValue!().length);\n      inputEl.setSelectionRange(this.inputs.inputValue!().length, item.searchTerm().length);\n      this.highlightedItem.set(item);\n    }\n  }\n\n  /** Closes the combobox. */\n  close(opts?: {reset: boolean}) {\n    const popupControls = this.inputs.popupControls();\n\n    if (this.inputs.alwaysExpanded()) {\n      return;\n    }\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      this.expanded.set(false);\n      return;\n    }\n\n    if (this.readonly()) {\n      this.expanded.set(false);\n      popupControls?.unfocus();\n      return;\n    }\n\n    if (!opts?.reset) {\n      if (this.inputs.filterMode() === 'manual') {\n        if (\n          !this.listControls()\n            ?.items()\n            .some(i => i.searchTerm() === this.inputs.inputEl()?.value)\n        ) {\n          this.listControls()?.clearSelection();\n        }\n      }\n\n      this.expanded.set(false);\n      popupControls?.unfocus();\n      return;\n    }\n\n    if (!this.expanded()) {\n      this.inputs.inputValue?.set('');\n      popupControls?.clearSelection();\n\n      const inputEl = this.inputs.inputEl();\n\n      if (inputEl) {\n        inputEl.value = '';\n      }\n    } else if (this.expanded()) {\n      this.expanded.set(false);\n      const selectedItem = popupControls?.getSelectedItems()?.[0];\n\n      if (selectedItem?.searchTerm() !== this.inputs.inputValue!()) {\n        popupControls?.clearSelection();\n      }\n\n      return;\n    }\n\n    this.close();\n\n    if (!this.readonly()) {\n      popupControls?.clearSelection();\n    }\n  }\n\n  /** Opens the combobox. */\n  open(nav?: {first?: boolean; last?: boolean; selected?: boolean}) {\n    this.expanded.set(true);\n    const popupControls = this.inputs.popupControls();\n\n    if (popupControls instanceof ComboboxDialogPattern) {\n      return;\n    }\n\n    const inputEl = this.inputs.inputEl();\n\n    if (inputEl && this.inputs.filterMode() === 'highlight') {\n      const isHighlighting = inputEl.selectionStart !== inputEl.value.length;\n      this.inputs.inputValue?.set(inputEl.value.slice(0, inputEl.selectionStart || 0));\n      if (!isHighlighting) {\n        this.highlightedItem.set(undefined);\n      }\n    }\n\n    if (nav?.first) {\n      this.first();\n    }\n    if (nav?.last) {\n      this.last();\n    }\n    if (nav?.selected) {\n      const selectedItem = popupControls\n        ?.items()\n        .find(i => popupControls?.getSelectedItems().includes(i));\n\n      if (selectedItem) {\n        popupControls?.focus(selectedItem);\n      }\n    }\n  }\n\n  /** Navigates to the next focusable item in the combobox popup. */\n  next() {\n    this._navigate(() => this.listControls()?.next());\n  }\n\n  /** Navigates to the previous focusable item in the combobox popup. */\n  prev() {\n    this._navigate(() => this.listControls()?.prev());\n  }\n\n  /** Navigates to the first focusable item in the combobox popup. */\n  first() {\n    this._navigate(() => this.listControls()?.first());\n  }\n\n  /** Navigates to the last focusable item in the combobox popup. */\n  last() {\n    this._navigate(() => this.listControls()?.last());\n  }\n\n  /** Collapses the currently focused item in the combobox. */\n  collapseItem() {\n    const controls = this.inputs.popupControls() as ComboboxTreeControls<T, V>;\n    this._navigate(() => controls?.collapseItem());\n  }\n\n  /** Expands the currently focused item in the combobox. */\n  expandItem() {\n    const controls = this.inputs.popupControls() as ComboboxTreeControls<T, V>;\n    this._navigate(() => controls?.expandItem());\n  }\n\n  /** Selects an item in the combobox popup. */\n  select(opts: {item?: T; commit?: boolean; close?: boolean} = {}) {\n    const controls = this.listControls();\n\n    // When no item is specified (e.g. on keyboard toggle), get the active item instead.\n    // Note: this is only necessary for disabled check, as select/toggle will check active item too.\n    const item = opts.item ?? controls?.getActiveItem();\n\n    // Check if item is disabled before proceeding.\n    if (item?.disabled()) {\n      return;\n    }\n\n    if (opts.item) {\n      controls?.focus(opts.item, {focusElement: false});\n    }\n\n    controls?.multi() ? controls.toggle(opts.item) : controls?.select(opts.item);\n\n    if (opts.commit) {\n      this.commit();\n    }\n    if (opts.close) {\n      this.close();\n    }\n  }\n\n  /** Updates the value of the input based on the currently selected item. */\n  commit() {\n    const inputEl = this.inputs.inputEl();\n    const selectedItems = this.listControls()?.getSelectedItems();\n\n    if (!inputEl) {\n      return;\n    }\n\n    inputEl.value = selectedItems?.map(i => i.searchTerm()).join(', ') || '';\n    this.inputs.inputValue?.set(inputEl.value);\n\n    if (this.inputs.filterMode() === 'highlight' && !this.readonly()) {\n      const length = inputEl.value.length;\n      inputEl.setSelectionRange(length, length);\n    }\n  }\n\n  /** Navigates and handles additional actions based on filter mode. */\n  private _navigate(operation: () => void) {\n    operation();\n\n    if (this.inputs.filterMode() !== 'manual') {\n      this.select();\n    }\n\n    if (this.inputs.filterMode() === 'highlight') {\n      // This is to handle when the user navigates back to the originally highlighted item.\n      // E.g. User types \"Al\", highlights \"Alice\", then navigates down and back up to \"Alice\".\n      const selectedItem = this.listControls()?.getSelectedItems()[0];\n\n      if (!selectedItem) {\n        return;\n      }\n\n      if (selectedItem === this.highlightedItem()) {\n        this.highlight();\n      } else {\n        const inputEl = this.inputs.inputEl()!;\n        inputEl.value = selectedItem?.searchTerm()!;\n      }\n    }\n  }\n}\n\nexport class ComboboxDialogPattern {\n  id = () => this.inputs.id();\n\n  role = () => 'dialog' as const;\n\n  keydown = computed(() => {\n    return new KeyboardEventManager().on('Escape', () => this.inputs.combobox.close());\n  });\n\n  constructor(\n    readonly inputs: {\n      combobox: ComboboxPattern<any, any>;\n      element: SignalLike<HTMLDialogElement>;\n      id: SignalLike<string>;\n    },\n  ) {}\n\n  onKeydown(event: KeyboardEvent) {\n    this.keydown().handle(event);\n  }\n\n  onClick(event: MouseEvent) {\n    // The \"click\" event fires on the dialog when the user clicks outside of the dialog content.\n    if (event.target === this.inputs.element()) {\n      this.inputs.combobox.close();\n    }\n  }\n}\n"],"names":["ComboboxPattern","inputs","expanded","signal","disabled","activeDescendant","computed","popupControls","ComboboxDialogPattern","activeId","highlightedItem","undefined","isDeleting","isFocused","hasBeenFocused","expandKey","textDirection","collapseKey","popupId","id","autocomplete","filterMode","hasPopup","role","readonly","listControls","treeControls","keydown","manager","KeyboardEventManager","on","open","alwaysExpanded","close","reset","first","last","selected","next","ignoreRepeat","prev","select","commit","multi","isItemSelectable","isItemExpandable","expandItem","collapseItem","isItemCollapsible","click","PointerEventManager","e","target","inputEl","controls","item","getItem","toggleExpansion","focus","constructor","onKeydown","event","handle","onClick","onInput","inputValue","set","value","InputEvent","inputType","match","highlight","onFocusIn","firstSelectedItem","getSelectedItems","onFocusOut","relatedTarget","HTMLElement","containerEl","contains","items","find","i","searchTerm","firstMatch","onFilter","isInitialRender","length","expandAll","collapseAll","clearSelection","unfocus","selectedItems","isHighlightable","toLowerCase","startsWith","slice","setSelectionRange","opts","some","selectedItem","nav","isHighlighting","selectionStart","includes","_navigate","getActiveItem","focusElement","toggle","map","join","operation","combobox","element"],"mappings":"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"}