{"version":3,"file":"_menu-chunk.mjs","sources":["../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/menu/menu.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {KeyboardEventManager} from '../behaviors/event-manager';\nimport {computed, signal, SignalLike} from '../behaviors/signal-like/signal-like';\nimport {List, ListInputs, ListItem} from '../behaviors/list/list';\n\n/** The inputs for the MenuBarPattern class. */\nexport interface MenuBarInputs<V> extends ListInputs<MenuItemPattern<V>, V> {\n  /** The menu items contained in the menu. */\n  items: SignalLike<MenuItemPattern<V>[]>;\n\n  /** Callback function triggered when a menu item is selected. */\n  onSelect?: (value: V) => void;\n\n  /** The text direction of the menu bar. */\n  textDirection: SignalLike<'ltr' | 'rtl'>;\n}\n\n/** The inputs for the MenuPattern class. */\nexport interface MenuInputs<V> extends Omit<ListInputs<MenuItemPattern<V>, V>, 'values'> {\n  /** The unique ID of the menu. */\n  id: SignalLike<string>;\n\n  /** The menu items contained in the menu. */\n  items: SignalLike<MenuItemPattern<V>[]>;\n\n  /** A reference to the parent menu or menu trigger. */\n  parent: SignalLike<MenuTriggerPattern<V> | MenuItemPattern<V> | undefined>;\n\n  /** Callback function triggered when a menu item is selected. */\n  onSelect?: (value: V) => void;\n\n  /** The text direction of the menu bar. */\n  textDirection: SignalLike<'ltr' | 'rtl'>;\n\n  /** The delay in milliseconds before expanding sub-menus on hover. */\n  expansionDelay: SignalLike<number>;\n}\n\n/** The inputs for the MenuTriggerPattern class. */\nexport interface MenuTriggerInputs<V> {\n  /** A reference to the menu trigger element. */\n  element: SignalLike<HTMLElement | undefined>;\n\n  /** A reference to the menu associated with the trigger. */\n  menu: SignalLike<MenuPattern<V> | undefined>;\n\n  /** The text direction of the menu bar. */\n  textDirection: SignalLike<'ltr' | 'rtl'>;\n\n  /** Whether the menu trigger is disabled. */\n  disabled: SignalLike<boolean>;\n}\n\n/** The inputs for the MenuItemPattern class. */\nexport interface MenuItemInputs<V> extends Omit<ListItem<V>, 'index' | 'selectable'> {\n  /** A reference to the parent menu or menu trigger. */\n  parent: SignalLike<MenuPattern<V> | MenuBarPattern<V> | undefined>;\n\n  /** A reference to the submenu associated with the menu item. */\n  submenu: SignalLike<MenuPattern<V> | undefined>;\n}\n\n/** The menu ui pattern class. */\nexport class MenuPattern<V> {\n  /** The unique ID of the menu. */\n  id: SignalLike<string>;\n\n  /** The role of the menu. */\n  role = () => 'menu';\n\n  /** Whether the menu is disabled. */\n  disabled = () => this.inputs.disabled();\n\n  /** Whether the menu is visible. */\n  visible = computed(() => (this.inputs.parent() ? !!this.inputs.parent()?.expanded() : true));\n\n  /** Controls list behavior for the menu items. */\n  listBehavior: List<MenuItemPattern<V>, V>;\n\n  /** Whether the menu or any of its child elements are currently focused. */\n  isFocused = signal(false);\n\n  /** Whether the menu has received focus. */\n  hasBeenFocused = signal(false);\n\n  /** Whether the menu trigger has been hovered. */\n  hasBeenHovered = signal(false);\n\n  /** Timeout used to open sub-menus on hover. */\n  _openTimeout: any;\n\n  /** Timeout used to close sub-menus on hover out. */\n  _closeTimeout: any;\n\n  /** The tab index of the menu. */\n  tabIndex = () => this.listBehavior.tabIndex();\n\n  /** Whether the menu should be focused on mouse over. */\n  shouldFocus = computed(() => {\n    const root = this.root();\n\n    if (root instanceof MenuTriggerPattern) {\n      return true;\n    }\n\n    if (root instanceof MenuBarPattern || root instanceof MenuPattern) {\n      return root.isFocused();\n    }\n\n    return false;\n  });\n\n  /** The key used to expand sub-menus. */\n  private _expandKey = computed(() => {\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight';\n  });\n\n  /** The key used to collapse sub-menus. */\n  private _collapseKey = computed(() => {\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft';\n  });\n\n  /** Represents the space key. Does nothing when the user is actively using typeahead. */\n  dynamicSpaceKey = computed(() => (this.listBehavior.isTyping() ? '' : ' '));\n\n  /** The regexp used to decide if a key should trigger typeahead. */\n  typeaheadRegexp = /^.$/;\n\n  /** The root of the menu. */\n  root: SignalLike<MenuTriggerPattern<V> | MenuBarPattern<V> | MenuPattern<V> | undefined> =\n    computed(() => {\n      const parent = this.inputs.parent();\n\n      if (!parent) {\n        return this;\n      }\n\n      if (parent instanceof MenuTriggerPattern) {\n        return parent;\n      }\n\n      const grandparent = parent.inputs.parent();\n\n      if (grandparent instanceof MenuBarPattern) {\n        return grandparent;\n      }\n\n      return grandparent?.root();\n    });\n\n  /** Handles keyboard events for the menu. */\n  keydownManager = computed(() => {\n    return new KeyboardEventManager()\n      .on('ArrowDown', () => this.next(), {ignoreRepeat: false})\n      .on('ArrowUp', () => this.prev(), {ignoreRepeat: false})\n      .on('Home', () => this.first())\n      .on('End', () => this.last())\n      .on('Enter', () => this.trigger())\n      .on('Escape', () => this.closeAll())\n      .on(this._expandKey, () => this.expand())\n      .on(this._collapseKey, () => this.collapse())\n      .on(this.dynamicSpaceKey, () => this.trigger())\n      .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n  });\n\n  constructor(readonly inputs: MenuInputs<V>) {\n    this.id = inputs.id;\n    this.listBehavior = new List<MenuItemPattern<V>, V>({\n      ...inputs,\n      values: signal([]),\n    });\n  }\n\n  /** Sets the default state for the menu. */\n  setDefaultState() {\n    if (!this.inputs.parent()) {\n      this.listBehavior.goto(this.inputs.items()[0], {focusElement: false});\n    }\n  }\n\n  /** Handles keyboard events for the menu. */\n  onKeydown(event: KeyboardEvent) {\n    this.keydownManager().handle(event);\n  }\n\n  /** Handles mouseover events for the menu. */\n  onMouseOver(event: MouseEvent) {\n    if (!this.visible()) {\n      return;\n    }\n\n    this.hasBeenHovered.set(true);\n    const item = this.inputs.items().find(i => i.element()?.contains(event.target as Node));\n\n    if (!item) {\n      return;\n    }\n\n    const parent = this.inputs.parent();\n    const activeItem = this?.inputs.activeItem();\n\n    if (parent instanceof MenuItemPattern) {\n      const grandparent = parent.inputs.parent();\n      if (grandparent instanceof MenuPattern) {\n        grandparent._clearTimeouts();\n        grandparent.listBehavior.goto(parent, {focusElement: false});\n      }\n    }\n\n    if (activeItem && activeItem !== item) {\n      this._closeItem(activeItem);\n    }\n\n    if (item.expanded()) {\n      this._clearCloseTimeout();\n    }\n\n    this._openItem(item);\n    this.listBehavior.goto(item, {focusElement: this.shouldFocus()});\n  }\n\n  /** Closes the specified menu item after a delay. */\n  private _closeItem(item: MenuItemPattern<V>) {\n    this._clearOpenTimeout();\n\n    if (!this._closeTimeout) {\n      this._closeTimeout = setTimeout(() => {\n        item.close();\n        this._closeTimeout = undefined;\n      }, this.inputs.expansionDelay());\n    }\n  }\n\n  /** Opens the specified menu item after a delay. */\n  private _openItem(item: MenuItemPattern<V>) {\n    this._clearOpenTimeout();\n\n    this._openTimeout = setTimeout(() => {\n      item.open();\n      this._openTimeout = undefined;\n    }, this.inputs.expansionDelay());\n  }\n\n  /** Handles mouseout events for the menu. */\n  onMouseOut(event: MouseEvent) {\n    this._clearOpenTimeout();\n\n    if (this.isFocused()) {\n      return;\n    }\n\n    const root = this.root();\n    const parent = this.inputs.parent();\n    const relatedTarget = event.relatedTarget as Node | null;\n\n    if (!root || !parent || parent instanceof MenuTriggerPattern) {\n      return;\n    }\n\n    const grandparent = parent.inputs.parent();\n\n    if (!grandparent || grandparent instanceof MenuBarPattern) {\n      return;\n    }\n\n    if (!grandparent.inputs.element()?.contains(relatedTarget)) {\n      parent.close();\n    }\n  }\n\n  /** Handles click events for the menu. */\n  onClick(event: MouseEvent) {\n    const relatedTarget = event.target as Node | null;\n    const item = this.inputs.items().find(i => i.element()?.contains(relatedTarget));\n\n    if (item) {\n      item.open();\n      this.listBehavior.goto(item);\n      this.submit(item);\n    }\n  }\n\n  /** Handles focusin events for the menu. */\n  onFocusIn() {\n    this.isFocused.set(true);\n    this.hasBeenFocused.set(true);\n  }\n\n  /** Handles the focusout event for the menu. */\n  onFocusOut(event: FocusEvent) {\n    const parent = this.inputs.parent();\n    const parentEl = parent?.inputs.element();\n    const relatedTarget = event.relatedTarget as Node | null;\n\n    if (!relatedTarget) {\n      this.isFocused.set(false);\n      this.inputs.parent()?.close({refocus: true});\n    }\n\n    if (parent instanceof MenuItemPattern) {\n      const grandparent = parent.inputs.parent();\n      const siblings = grandparent?.inputs.items().filter(i => i !== parent);\n      const item = siblings?.find(i => i.element()?.contains(relatedTarget));\n\n      if (item) {\n        return;\n      }\n    }\n\n    if (\n      this.visible() &&\n      !parentEl?.contains(relatedTarget) &&\n      !this.inputs.element()?.contains(relatedTarget)\n    ) {\n      this.isFocused.set(false);\n      this.inputs.parent()?.close();\n    }\n  }\n\n  /** Focuses the previous menu item. */\n  prev() {\n    this.inputs.activeItem()?.close();\n    this.listBehavior.prev();\n  }\n\n  /** Focuses the next menu item. */\n  next() {\n    this.inputs.activeItem()?.close();\n    this.listBehavior.next();\n  }\n\n  /** Focuses the first menu item. */\n  first() {\n    this.inputs.activeItem()?.close();\n    this.listBehavior.first();\n  }\n\n  /** Focuses the last menu item. */\n  last() {\n    this.inputs.activeItem()?.close();\n    this.listBehavior.last();\n  }\n\n  /** Triggers the active menu item. */\n  trigger() {\n    this.inputs.activeItem()?.hasPopup()\n      ? this.inputs.activeItem()?.open({first: true})\n      : this.submit();\n  }\n\n  /** Submits the menu. */\n  submit(item = this.inputs.activeItem()) {\n    const root = this.root();\n\n    if (item && !item.disabled()) {\n      const isMenu = root instanceof MenuPattern;\n      const isMenuBar = root instanceof MenuBarPattern;\n      const isMenuTrigger = root instanceof MenuTriggerPattern;\n\n      if (!item.submenu() && isMenuTrigger) {\n        root.close({refocus: true});\n      }\n\n      if (!item.submenu() && isMenuBar) {\n        root.close();\n        root?.inputs.onSelect?.(item.value());\n      }\n\n      if (!item.submenu() && isMenu) {\n        root.inputs.activeItem()?.close({refocus: true});\n        root?.inputs.onSelect?.(item.value());\n      }\n    }\n  }\n\n  /** Collapses the current menu or focuses the previous item in the menubar. */\n  collapse() {\n    const root = this.root();\n    const parent = this.inputs.parent();\n\n    if (parent instanceof MenuItemPattern && !(parent.inputs.parent() instanceof MenuBarPattern)) {\n      parent.close({refocus: true});\n    } else if (root instanceof MenuBarPattern) {\n      root.prev();\n    }\n  }\n\n  /** Expands the current menu or focuses the next item in the menubar. */\n  expand() {\n    const root = this.root();\n    const activeItem = this.inputs.activeItem();\n\n    if (activeItem?.submenu()) {\n      activeItem.open({first: true});\n    } else if (root instanceof MenuBarPattern) {\n      root.next();\n    }\n  }\n\n  /** Closes the menu. */\n  close() {\n    this.inputs.parent()?.close();\n  }\n\n  /** Closes the menu and all parent menus. */\n  closeAll() {\n    const root = this.root();\n\n    if (root instanceof MenuTriggerPattern) {\n      root.close({refocus: true});\n    }\n\n    if (root instanceof MenuBarPattern) {\n      root.close();\n    }\n\n    if (root instanceof MenuPattern) {\n      root.inputs.activeItem()?.close({refocus: true});\n    }\n  }\n\n  /** Clears any open or close timeouts for sub-menus. */\n  _clearTimeouts() {\n    this._clearOpenTimeout();\n    this._clearCloseTimeout();\n  }\n\n  /** Clears the open timeout. */\n  _clearOpenTimeout() {\n    if (this._openTimeout) {\n      clearTimeout(this._openTimeout);\n      this._openTimeout = undefined;\n    }\n  }\n\n  /** Clears the close timeout. */\n  _clearCloseTimeout() {\n    if (this._closeTimeout) {\n      clearTimeout(this._closeTimeout);\n      this._closeTimeout = undefined;\n    }\n  }\n}\n\n/** The menubar ui pattern class. */\nexport class MenuBarPattern<V> {\n  /** Controls list behavior for the menu items. */\n  listBehavior: List<MenuItemPattern<V>, V>;\n\n  /** The tab index of the menu. */\n  tabIndex = () => this.listBehavior.tabIndex();\n\n  /** The key used to navigate to the next item. */\n  private _nextKey = computed(() => {\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight';\n  });\n\n  /** The key used to navigate to the previous item. */\n  private _previousKey = computed(() => {\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft';\n  });\n\n  /** Represents the space key. Does nothing when the user is actively using typeahead. */\n  dynamicSpaceKey = computed(() => (this.listBehavior.isTyping() ? '' : ' '));\n\n  /** The regexp used to decide if a key should trigger typeahead. */\n  typeaheadRegexp = /^.$/;\n\n  /** Whether the menubar or any of its children are currently focused. */\n  isFocused = signal(false);\n\n  /** Whether the menubar has been focused. */\n  hasBeenFocused = signal(false);\n\n  /** Whether the menubar is disabled. */\n  disabled = () => this.inputs.disabled();\n\n  /** Handles keyboard events for the menu. */\n  keydownManager = computed(() => {\n    return new KeyboardEventManager()\n      .on(this._nextKey, () => this.next(), {ignoreRepeat: false})\n      .on(this._previousKey, () => this.prev(), {ignoreRepeat: false})\n      .on('End', () => this.listBehavior.last())\n      .on('Home', () => this.listBehavior.first())\n      .on('Enter', () => this.inputs.activeItem()?.open({first: true}))\n      .on('ArrowUp', () => this.inputs.activeItem()?.open({last: true}))\n      .on('ArrowDown', () => this.inputs.activeItem()?.open({first: true}))\n      .on(this.dynamicSpaceKey, () => this.inputs.activeItem()?.open({first: true}))\n      .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n  });\n\n  constructor(readonly inputs: MenuBarInputs<V>) {\n    this.listBehavior = new List<MenuItemPattern<V>, V>(inputs);\n  }\n\n  /** Sets the default state for the menubar. */\n  setDefaultState() {\n    this.inputs.activeItem.set(this.inputs.items()[0]);\n  }\n\n  /** Handles keyboard events for the menu. */\n  onKeydown(event: KeyboardEvent) {\n    this.keydownManager().handle(event);\n  }\n\n  /** Handles click events for the menu bar. */\n  onClick(event: MouseEvent) {\n    const item = this.inputs.items().find(i => i.element()?.contains(event.target as Node));\n\n    if (!item) {\n      return;\n    }\n\n    this.goto(item);\n    item.expanded() ? item.close() : item.open();\n  }\n\n  /** Handles mouseover events for the menu bar. */\n  onMouseOver(event: MouseEvent) {\n    const item = this.inputs.items().find(i => i.element()?.contains(event.target as Node));\n\n    if (item) {\n      this.goto(item, {focusElement: this.isFocused()});\n    }\n  }\n\n  /** Handles focusin events for the menu bar. */\n  onFocusIn() {\n    this.isFocused.set(true);\n    this.hasBeenFocused.set(true);\n  }\n\n  /** Handles focusout events for the menu bar. */\n  onFocusOut(event: FocusEvent) {\n    const relatedTarget = event.relatedTarget as Node | null;\n\n    if (!this.inputs.element()?.contains(relatedTarget)) {\n      this.isFocused.set(false);\n      this.close();\n    }\n  }\n\n  /** Goes to and optionally focuses the specified menu item. */\n  goto(item: MenuItemPattern<V>, opts?: {focusElement?: boolean}) {\n    const prevItem = this.inputs.activeItem();\n    this.listBehavior.goto(item, opts);\n\n    if (prevItem?.expanded()) {\n      prevItem?.close();\n      this.inputs.activeItem()?.open();\n    }\n\n    if (item === prevItem) {\n      if (item.expanded() && item.submenu()?.inputs.activeItem()) {\n        item.submenu()?.inputs.activeItem()?.close();\n        item.submenu()?.listBehavior.unfocus();\n      }\n    }\n  }\n\n  /** Focuses the next menu item. */\n  next() {\n    const prevItem = this.inputs.activeItem();\n    this.listBehavior.next();\n\n    if (prevItem?.expanded()) {\n      prevItem?.close();\n      this.inputs.activeItem()?.open({first: true});\n    }\n  }\n\n  /** Focuses the previous menu item. */\n  prev() {\n    const prevItem = this.inputs.activeItem();\n    this.listBehavior.prev();\n\n    if (prevItem?.expanded()) {\n      prevItem?.close();\n      this.inputs.activeItem()?.open({first: true});\n    }\n  }\n\n  /** Closes the menubar and refocuses the root menu bar item. */\n  close() {\n    this.inputs.activeItem()?.close({refocus: this.isFocused()});\n  }\n}\n\n/** The menu trigger ui pattern class. */\nexport class MenuTriggerPattern<V> {\n  /** Whether the menu is expanded. */\n  expanded = signal(false);\n\n  /** Whether the menu trigger has received focus. */\n  hasBeenFocused = signal(false);\n\n  /** The role of the menu trigger. */\n  role = () => 'button';\n\n  /** Whether the menu trigger has a popup. */\n  hasPopup = () => true;\n\n  /** The menu associated with the trigger. */\n  menu: SignalLike<MenuPattern<V> | undefined>;\n\n  /** The tab index of the menu trigger. */\n  tabIndex = computed(() => (this.expanded() && this.menu()?.inputs.activeItem() ? -1 : 0));\n\n  /** Whether the menu trigger is disabled. */\n  disabled = () => this.inputs.disabled();\n\n  /** Handles keyboard events for the menu trigger. */\n  keydownManager = computed(() => {\n    return new KeyboardEventManager()\n      .on(' ', () => this.open({first: true}))\n      .on('Enter', () => this.open({first: true}))\n      .on('ArrowDown', () => this.open({first: true}))\n      .on('ArrowUp', () => this.open({last: true}))\n      .on('Escape', () => this.close({refocus: true}));\n  });\n\n  constructor(readonly inputs: MenuTriggerInputs<V>) {\n    this.menu = this.inputs.menu;\n  }\n\n  /** Handles keyboard events for the menu trigger. */\n  onKeydown(event: KeyboardEvent) {\n    if (!this.inputs.disabled()) {\n      this.keydownManager().handle(event);\n    }\n  }\n\n  /** Handles click events for the menu trigger. */\n  onClick() {\n    if (!this.inputs.disabled()) {\n      this.expanded() ? this.close() : this.open({first: true});\n    }\n  }\n\n  /** Handles focusin events for the menu trigger. */\n  onFocusIn() {\n    this.hasBeenFocused.set(true);\n  }\n\n  /** Handles focusout events for the menu trigger. */\n  onFocusOut(event: FocusEvent) {\n    const element = this.inputs.element();\n    const relatedTarget = event.relatedTarget as Node | null;\n\n    if (\n      this.expanded() &&\n      !element?.contains(relatedTarget) &&\n      !this.inputs.menu()?.inputs.element()?.contains(relatedTarget)\n    ) {\n      this.close();\n    }\n  }\n\n  /** Opens the menu. */\n  open(opts?: {first?: boolean; last?: boolean}) {\n    this.expanded.set(true);\n\n    if (opts?.first) {\n      this.inputs.menu()?.first();\n    } else if (opts?.last) {\n      this.inputs.menu()?.last();\n    }\n  }\n\n  /** Closes the menu. */\n  close(opts: {refocus?: boolean} = {}) {\n    this.expanded.set(false);\n    this.menu()?.listBehavior.unfocus();\n\n    if (opts.refocus) {\n      this.inputs.element()?.focus();\n    }\n\n    let menuitems = this.inputs.menu()?.inputs.items() ?? [];\n\n    while (menuitems.length) {\n      const menuitem = menuitems.pop();\n      menuitem?._expanded.set(false);\n      menuitem?.inputs.parent()?.listBehavior.unfocus();\n      menuitems = menuitems.concat(menuitem?.submenu()?.inputs.items() ?? []);\n    }\n  }\n}\n\n/** The menu item ui pattern class. */\nexport class MenuItemPattern<V> implements ListItem<V> {\n  /** The value of the menu item. */\n  value: SignalLike<V>;\n\n  /** The unique ID of the menu item. */\n  id: SignalLike<string>;\n\n  /** Whether the menu item is disabled. */\n  disabled = () => this.inputs.parent()?.disabled() || this.inputs.disabled();\n\n  /** The search term for the menu item. */\n  searchTerm: SignalLike<string>;\n\n  /** The element of the menu item. */\n  element: SignalLike<HTMLElement | undefined>;\n\n  /** Whether the menu item is active. */\n  active = computed(() => this.inputs.parent()?.inputs.activeItem() === this);\n\n  /** Whether the menu item has received focus. */\n  hasBeenFocused = signal(false);\n\n  /** The tab index of the menu item. */\n  tabIndex = computed(() => {\n    if (this.submenu() && this.submenu()?.inputs.activeItem()) {\n      return -1;\n    }\n    return this.inputs.parent()?.listBehavior.getItemTabindex(this) ?? -1;\n  });\n\n  /** The position of the menu item in the menu. */\n  index = computed(() => this.inputs.parent()?.inputs.items().indexOf(this) ?? -1);\n\n  /** Whether the menu item is expanded. */\n  expanded = computed(() => (this.submenu() ? this._expanded() : null));\n\n  /** Whether the menu item is expanded. */\n  _expanded = signal(false);\n\n  /** The ID of the menu that the menu item controls. */\n  controls = signal<string | undefined>(undefined);\n\n  /** The role of the menu item. */\n  role = () => 'menuitem';\n\n  /** Whether the menu item has a popup. */\n  hasPopup = computed(() => !!this.submenu());\n\n  /** The submenu associated with the menu item. */\n  submenu: SignalLike<MenuPattern<V> | undefined>;\n\n  /** Whether the menu item is selectable. */\n  selectable: SignalLike<boolean>;\n\n  constructor(readonly inputs: MenuItemInputs<V>) {\n    this.id = inputs.id;\n    this.value = inputs.value;\n    this.element = inputs.element;\n    this.submenu = this.inputs.submenu;\n    this.searchTerm = inputs.searchTerm;\n    this.selectable = computed(() => !this.submenu());\n  }\n\n  /** Opens the submenu. */\n  open(opts?: {first?: boolean; last?: boolean}) {\n    if (this.disabled()) {\n      return;\n    }\n\n    this._expanded.set(true);\n\n    if (opts?.first) {\n      this.submenu()?.first();\n    }\n    if (opts?.last) {\n      this.submenu()?.last();\n    }\n  }\n\n  /** Closes the submenu. */\n  close(opts: {refocus?: boolean} = {}) {\n    this._expanded.set(false);\n\n    if (opts.refocus) {\n      this.inputs.parent()?.listBehavior.goto(this);\n    }\n\n    let menuitems = this.inputs.submenu()?.inputs.items() ?? [];\n\n    while (menuitems.length) {\n      const menuitem = menuitems.pop();\n      menuitem?._expanded.set(false);\n      menuitem?.inputs.parent()?.listBehavior.unfocus();\n      menuitems = menuitems.concat(menuitem?.submenu()?.inputs.items() ?? []);\n\n      const parent = menuitem?.inputs.parent();\n\n      if (parent instanceof MenuPattern) {\n        parent._clearTimeouts();\n      }\n    }\n  }\n\n  /** Handles focusin events for the menu item. */\n  onFocusIn() {\n    this.hasBeenFocused.set(true);\n  }\n}\n"],"names":["MenuPattern","inputs","id","role","disabled","visible","computed","parent","expanded","listBehavior","isFocused","signal","hasBeenFocused","hasBeenHovered","_openTimeout","_closeTimeout","tabIndex","shouldFocus","root","MenuTriggerPattern","MenuBarPattern","_expandKey","textDirection","_collapseKey","dynamicSpaceKey","isTyping","typeaheadRegexp","grandparent","keydownManager","KeyboardEventManager","on","next","ignoreRepeat","prev","first","last","trigger","closeAll","expand","collapse","e","search","key","constructor","List","values","setDefaultState","goto","items","focusElement","onKeydown","event","handle","onMouseOver","set","item","find","i","element","contains","target","activeItem","MenuItemPattern","_clearTimeouts","_closeItem","_clearCloseTimeout","_openItem","_clearOpenTimeout","setTimeout","close","undefined","expansionDelay","open","onMouseOut","relatedTarget","onClick","submit","onFocusIn","onFocusOut","parentEl","refocus","siblings","filter","hasPopup","isMenu","isMenuBar","isMenuTrigger","submenu","onSelect","value","clearTimeout","_nextKey","_previousKey","opts","prevItem","unfocus","menu","focus","menuitems","length","menuitem","pop","_expanded","concat","searchTerm","active","getItemTabindex","index","indexOf","controls","selectable"],"mappings":"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"}