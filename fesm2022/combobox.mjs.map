{"version":3,"file":"combobox.mjs","sources":["../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/combobox/combobox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  afterRenderEffect,\n  computed,\n  contentChild,\n  Directive,\n  ElementRef,\n  inject,\n  input,\n  model,\n  signal,\n  untracked,\n  WritableSignal,\n} from '@angular/core';\nimport {\n  DeferredContent,\n  DeferredContentAware,\n  ComboboxPattern,\n  ComboboxListboxControls,\n  ComboboxTreeControls,\n} from '@angular/aria/private';\nimport {Directionality} from '@angular/cdk/bidi';\nimport {toSignal} from '@angular/core/rxjs-interop';\n\n@Directive({\n  selector: '[ngCombobox]',\n  exportAs: 'ngCombobox',\n  hostDirectives: [\n    {\n      directive: DeferredContentAware,\n      inputs: ['preserveContent'],\n    },\n  ],\n  host: {\n    '[attr.data-expanded]': 'expanded()',\n    '(input)': '_pattern.onInput($event)',\n    '(keydown)': '_pattern.onKeydown($event)',\n    '(pointerup)': '_pattern.onPointerup($event)',\n    '(focusin)': '_pattern.onFocusIn()',\n    '(focusout)': '_pattern.onFocusOut($event)',\n  },\n})\nexport class Combobox<V> {\n  /** The directionality (LTR / RTL) context for the application (or a subtree of it). */\n  private readonly _directionality = inject(Directionality);\n\n  /** A signal wrapper for directionality. */\n  protected textDirection = toSignal(this._directionality.change, {\n    initialValue: this._directionality.value,\n  });\n\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject(ElementRef);\n\n  /** The DeferredContentAware host directive. */\n  private readonly _deferredContentAware = inject(DeferredContentAware, {optional: true});\n\n  /** The combobox popup. */\n  readonly popup = contentChild<ComboboxPopup<V>>(ComboboxPopup);\n\n  /** The filter mode for the combobox. */\n  filterMode = input<'manual' | 'auto-select' | 'highlight'>('manual');\n\n  /** Whether the combobox is focused. */\n  readonly isFocused = signal(false);\n\n  /** Whether the listbox has received focus yet. */\n  private _hasBeenFocused = signal(false);\n\n  /** Whether the combobox is disabled. */\n  readonly disabled = input(false);\n\n  /** Whether the combobox is read-only. */\n  readonly readonly = input(false);\n\n  /** The value of the first matching item in the popup. */\n  readonly firstMatch = input<V | undefined>(undefined);\n\n  /** Whether the combobox is expanded. */\n  readonly expanded = computed(() => this._pattern.expanded());\n\n  /** Input element connected to the combobox, if any. */\n  readonly inputElement = computed(() => this._pattern.inputs.inputEl());\n\n  /** The combobox ui pattern. */\n  readonly _pattern = new ComboboxPattern<any, V>({\n    ...this,\n    textDirection: this.textDirection,\n    disabled: this.disabled,\n    readonly: this.readonly,\n    inputValue: signal(''),\n    inputEl: signal(undefined),\n    containerEl: () => this._elementRef.nativeElement,\n    popupControls: () => this.popup()?.controls(),\n  });\n\n  constructor() {\n    afterRenderEffect(() => {\n      if (!this._deferredContentAware?.contentVisible() && this._pattern.isFocused()) {\n        this._deferredContentAware?.contentVisible.set(true);\n      }\n    });\n\n    afterRenderEffect(() => {\n      if (!this._hasBeenFocused() && this._pattern.isFocused()) {\n        this._hasBeenFocused.set(true);\n      }\n    });\n  }\n}\n\n@Directive({\n  selector: 'input[ngComboboxInput]',\n  exportAs: 'ngComboboxInput',\n  host: {\n    'role': 'combobox',\n    '[value]': 'value()',\n    '[attr.aria-expanded]': 'combobox._pattern.expanded()',\n    '[attr.aria-activedescendant]': 'combobox._pattern.activeDescendant()',\n    '[attr.aria-controls]': 'combobox._pattern.popupId()',\n    '[attr.aria-haspopup]': 'combobox._pattern.hasPopup()',\n    '[attr.aria-autocomplete]': 'combobox._pattern.autocomplete()',\n    '[attr.readonly]': 'combobox._pattern.readonly()',\n  },\n})\nexport class ComboboxInput {\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject<ElementRef<HTMLInputElement>>(ElementRef);\n\n  /** The combobox that the input belongs to. */\n  readonly combobox = inject(Combobox);\n\n  /** The value of the input. */\n  value = model<string>('');\n\n  constructor() {\n    (this.combobox._pattern.inputs.inputEl as WritableSignal<HTMLInputElement>).set(\n      this._elementRef.nativeElement,\n    );\n    this.combobox._pattern.inputs.inputValue = this.value;\n\n    /** Focuses & selects the first item in the combobox if the user changes the input value. */\n    afterRenderEffect(() => {\n      this.value();\n      this.combobox.popup()?.controls()?.items();\n      untracked(() => this.combobox._pattern.onFilter());\n    });\n  }\n}\n\n@Directive({\n  selector: 'ng-template[ngComboboxPopupContainer]',\n  exportAs: 'ngComboboxPopupContainer',\n  hostDirectives: [DeferredContent],\n})\nexport class ComboboxPopupContainer {}\n\n@Directive({\n  selector: '[ngComboboxPopup]',\n  exportAs: 'ngComboboxPopup',\n})\nexport class ComboboxPopup<V> {\n  /** The combobox that the popup belongs to. */\n  readonly combobox = inject<Combobox<V>>(Combobox, {optional: true});\n\n  /** The controls the popup exposes to the combobox. */\n  readonly controls = signal<\n    ComboboxListboxControls<any, V> | ComboboxTreeControls<any, V> | undefined\n  >(undefined);\n}\n"],"names":["Combobox","inject","toSignal","_directionality","change","_deferredContentAware","DeferredContentAware","optional","ComboboxPopup","ngDevMode","debugName","_hasBeenFocused","signal","disabled","input","readonly","firstMatch","undefined","expanded","computed","_pattern","inputElement","inputs","inputEl","ComboboxPattern","inputValue","containerEl","_elementRef","nativeElement","popupControls","popup","controls","afterRenderEffect","contentVisible","isFocused","set","ɵfac","i0","ɵɵngDeclareFactory","minVersion","version","ngImport","type","deps","target","ɵɵFactoryTarget","Directive","ɵdir","ɵɵngDeclareDirective","isStandalone","selector","filterMode","classPropertyName","publicName","isSignal","isRequired","transformFunction","host","listeners","properties","queries","propertyName","first","predicate","descendants","exportAs","hostDirectives","directive","i1","decorators","args","ctorParameters","ElementRef","constructor","combobox","value","items","untracked","onFilter","ComboboxPopupContainer","DeferredContent"],"mappings":"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"}