{"version":3,"file":"combobox.mjs","sources":["../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/combobox/combobox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  afterRenderEffect,\n  computed,\n  contentChild,\n  Directive,\n  ElementRef,\n  inject,\n  input,\n  model,\n  signal,\n  untracked,\n  WritableSignal,\n} from '@angular/core';\nimport {DeferredContent, DeferredContentAware} from '@angular/aria/deferred-content';\nimport {\n  ComboboxPattern,\n  ComboboxListboxControls,\n  ComboboxTreeControls,\n} from '@angular/aria/private';\nimport {Directionality} from '@angular/cdk/bidi';\nimport {toSignal} from '@angular/core/rxjs-interop';\n\n@Directive({\n  selector: '[ngCombobox]',\n  exportAs: 'ngCombobox',\n  hostDirectives: [\n    {\n      directive: DeferredContentAware,\n      inputs: ['preserveContent'],\n    },\n  ],\n  host: {\n    '[attr.data-expanded]': 'expanded()',\n    '(input)': '_pattern.onInput($event)',\n    '(keydown)': '_pattern.onKeydown($event)',\n    '(pointerup)': '_pattern.onPointerup($event)',\n    '(focusin)': '_pattern.onFocusIn()',\n    '(focusout)': '_pattern.onFocusOut($event)',\n  },\n})\nexport class Combobox<V> {\n  /** The directionality (LTR / RTL) context for the application (or a subtree of it). */\n  private readonly _directionality = inject(Directionality);\n\n  /** A signal wrapper for directionality. */\n  protected textDirection = toSignal(this._directionality.change, {\n    initialValue: this._directionality.value,\n  });\n\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject(ElementRef);\n\n  /** The DeferredContentAware host directive. */\n  private readonly _deferredContentAware = inject(DeferredContentAware, {optional: true});\n\n  /** The combobox popup. */\n  readonly popup = contentChild<ComboboxPopup<V>>(ComboboxPopup);\n\n  /** The filter mode for the combobox. */\n  filterMode = input<'manual' | 'auto-select' | 'highlight'>('manual');\n\n  /** Whether the combobox is focused. */\n  readonly isFocused = signal(false);\n\n  /** Whether the listbox has received focus yet. */\n  private _hasBeenFocused = signal(false);\n\n  /** Whether the combobox is disabled. */\n  readonly disabled = input(false);\n\n  /** Whether the combobox is read-only. */\n  readonly readonly = input(false);\n\n  /** The value of the first matching item in the popup. */\n  readonly firstMatch = input<V | undefined>(undefined);\n\n  /** Whether the combobox is expanded. */\n  readonly expanded = computed(() => this._pattern.expanded());\n\n  /** Input element connected to the combobox, if any. */\n  readonly inputElement = computed(() => this._pattern.inputs.inputEl());\n\n  /** The combobox ui pattern. */\n  readonly _pattern = new ComboboxPattern<any, V>({\n    ...this,\n    textDirection: this.textDirection,\n    disabled: this.disabled,\n    readonly: this.readonly,\n    inputValue: signal(''),\n    inputEl: signal(undefined),\n    containerEl: () => this._elementRef.nativeElement,\n    popupControls: () => this.popup()?.controls(),\n  });\n\n  constructor() {\n    afterRenderEffect(() => {\n      if (!this._deferredContentAware?.contentVisible() && this._pattern.isFocused()) {\n        this._deferredContentAware?.contentVisible.set(true);\n      }\n    });\n\n    afterRenderEffect(() => {\n      if (!this._hasBeenFocused() && this._pattern.isFocused()) {\n        this._hasBeenFocused.set(true);\n      }\n    });\n  }\n}\n\n@Directive({\n  selector: 'input[ngComboboxInput]',\n  exportAs: 'ngComboboxInput',\n  host: {\n    'role': 'combobox',\n    '[value]': 'value()',\n    '[attr.aria-expanded]': 'combobox._pattern.expanded()',\n    '[attr.aria-activedescendant]': 'combobox._pattern.activedescendant()',\n    '[attr.aria-controls]': 'combobox._pattern.popupId()',\n    '[attr.aria-haspopup]': 'combobox._pattern.hasPopup()',\n    '[attr.aria-autocomplete]': 'combobox._pattern.autocomplete()',\n    '[attr.readonly]': 'combobox._pattern.readonly()',\n  },\n})\nexport class ComboboxInput {\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject<ElementRef<HTMLInputElement>>(ElementRef);\n\n  /** The combobox that the input belongs to. */\n  readonly combobox = inject(Combobox);\n\n  /** The value of the input. */\n  value = model<string>('');\n\n  constructor() {\n    (this.combobox._pattern.inputs.inputEl as WritableSignal<HTMLInputElement>).set(\n      this._elementRef.nativeElement,\n    );\n    this.combobox._pattern.inputs.inputValue = this.value;\n\n    /** Focuses & selects the first item in the combobox if the user changes the input value. */\n    afterRenderEffect(() => {\n      this.value();\n      this.combobox.popup()?.controls()?.items();\n      untracked(() => this.combobox._pattern.onFilter());\n    });\n  }\n}\n\n@Directive({\n  selector: 'ng-template[ngComboboxPopupContainer]',\n  exportAs: 'ngComboboxPopupContainer',\n  hostDirectives: [DeferredContent],\n})\nexport class ComboboxPopupContainer {}\n\n@Directive({\n  selector: '[ngComboboxPopup]',\n  exportAs: 'ngComboboxPopup',\n})\nexport class ComboboxPopup<V> {\n  /** The combobox that the popup belongs to. */\n  readonly combobox = inject<Combobox<V>>(Combobox, {optional: true});\n\n  /** The controls the popup exposes to the combobox. */\n  readonly controls = signal<\n    ComboboxListboxControls<any, V> | ComboboxTreeControls<any, V> | undefined\n  >(undefined);\n}\n"],"names":[],"mappings":"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"}