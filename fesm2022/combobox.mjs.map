{"version":3,"file":"combobox.mjs","sources":["../../../../../k8-fastbuild-ST-199a4f3c4e20/bin/src/aria/combobox/combobox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  afterRenderEffect,\n  computed,\n  contentChild,\n  Directive,\n  ElementRef,\n  inject,\n  input,\n  model,\n  signal,\n  untracked,\n  WritableSignal,\n} from '@angular/core';\nimport {\n  DeferredContent,\n  DeferredContentAware,\n  ComboboxPattern,\n  ComboboxListboxControls,\n  ComboboxTreeControls,\n} from '@angular/aria/private';\nimport {Directionality} from '@angular/cdk/bidi';\nimport {toSignal} from '@angular/core/rxjs-interop';\n\n@Directive({\n  selector: '[ngCombobox]',\n  exportAs: 'ngCombobox',\n  hostDirectives: [\n    {\n      directive: DeferredContentAware,\n      inputs: ['preserveContent'],\n    },\n  ],\n  host: {\n    '[attr.data-expanded]': 'expanded()',\n    '(input)': '_pattern.onInput($event)',\n    '(keydown)': '_pattern.onKeydown($event)',\n    '(pointerup)': '_pattern.onPointerup($event)',\n    '(focusin)': '_pattern.onFocusIn()',\n    '(focusout)': '_pattern.onFocusOut($event)',\n  },\n})\nexport class Combobox<V> {\n  /** The directionality (LTR / RTL) context for the application (or a subtree of it). */\n  private readonly _directionality = inject(Directionality);\n\n  /** A signal wrapper for directionality. */\n  protected textDirection = toSignal(this._directionality.change, {\n    initialValue: this._directionality.value,\n  });\n\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject(ElementRef);\n\n  /** The DeferredContentAware host directive. */\n  private readonly _deferredContentAware = inject(DeferredContentAware, {optional: true});\n\n  /** The combobox popup. */\n  readonly popup = contentChild<ComboboxPopup<V>>(ComboboxPopup);\n\n  /** The filter mode for the combobox. */\n  filterMode = input<'manual' | 'auto-select' | 'highlight'>('manual');\n\n  /** Whether the combobox is focused. */\n  readonly isFocused = signal(false);\n\n  /** Whether the combobox has received focus yet. */\n  private _hasBeenFocused = signal(false);\n\n  /** Whether the combobox is disabled. */\n  readonly disabled = input(false);\n\n  /** Whether the combobox is read-only. */\n  readonly readonly = input(false);\n\n  /** The value of the first matching item in the popup. */\n  readonly firstMatch = input<V | undefined>(undefined);\n\n  /** Whether the combobox is expanded. */\n  readonly expanded = computed(() => this._pattern.expanded());\n\n  /** Input element connected to the combobox, if any. */\n  readonly inputElement = computed(() => this._pattern.inputs.inputEl());\n\n  /** The combobox ui pattern. */\n  readonly _pattern = new ComboboxPattern<any, V>({\n    ...this,\n    textDirection: this.textDirection,\n    disabled: this.disabled,\n    readonly: this.readonly,\n    inputValue: signal(''),\n    inputEl: signal(undefined),\n    containerEl: () => this._elementRef.nativeElement,\n    popupControls: () => this.popup()?.controls(),\n  });\n\n  constructor() {\n    afterRenderEffect(() => {\n      if (!this._deferredContentAware?.contentVisible() && this._pattern.isFocused()) {\n        this._deferredContentAware?.contentVisible.set(true);\n      }\n    });\n\n    afterRenderEffect(() => {\n      if (!this._hasBeenFocused() && this._pattern.isFocused()) {\n        this._hasBeenFocused.set(true);\n      }\n    });\n  }\n}\n\n@Directive({\n  selector: 'input[ngComboboxInput]',\n  exportAs: 'ngComboboxInput',\n  host: {\n    'role': 'combobox',\n    '[value]': 'value()',\n    '[attr.aria-expanded]': 'combobox._pattern.expanded()',\n    '[attr.aria-activedescendant]': 'combobox._pattern.activeDescendant()',\n    '[attr.aria-controls]': 'combobox._pattern.popupId()',\n    '[attr.aria-haspopup]': 'combobox._pattern.hasPopup()',\n    '[attr.aria-autocomplete]': 'combobox._pattern.autocomplete()',\n    '[attr.readonly]': 'combobox._pattern.readonly()',\n  },\n})\nexport class ComboboxInput {\n  /** The element that the combobox is attached to. */\n  private readonly _elementRef = inject<ElementRef<HTMLInputElement>>(ElementRef);\n\n  /** The combobox that the input belongs to. */\n  readonly combobox = inject(Combobox);\n\n  /** The value of the input. */\n  value = model<string>('');\n\n  constructor() {\n    (this.combobox._pattern.inputs.inputEl as WritableSignal<HTMLInputElement>).set(\n      this._elementRef.nativeElement,\n    );\n    this.combobox._pattern.inputs.inputValue = this.value;\n\n    /** Focuses & selects the first item in the combobox if the user changes the input value. */\n    afterRenderEffect(() => {\n      this.value();\n      this.combobox.popup()?.controls()?.items();\n      untracked(() => this.combobox._pattern.onFilter());\n    });\n  }\n}\n\n@Directive({\n  selector: 'ng-template[ngComboboxPopupContainer]',\n  exportAs: 'ngComboboxPopupContainer',\n  hostDirectives: [DeferredContent],\n})\nexport class ComboboxPopupContainer {}\n\n@Directive({\n  selector: '[ngComboboxPopup]',\n  exportAs: 'ngComboboxPopup',\n})\nexport class ComboboxPopup<V> {\n  /** The combobox that the popup belongs to. */\n  readonly combobox = inject<Combobox<V>>(Combobox, {optional: true});\n\n  /** The controls the popup exposes to the combobox. */\n  readonly controls = signal<\n    ComboboxListboxControls<any, V> | ComboboxTreeControls<any, V> | undefined\n  >(undefined);\n}\n"],"names":["Combobox","_directionality","inject","Directionality","textDirection","toSignal","change","initialValue","value","_elementRef","ElementRef","_deferredContentAware","DeferredContentAware","optional","popup","contentChild","ComboboxPopup","filterMode","input","isFocused","signal","_hasBeenFocused","disabled","readonly","firstMatch","undefined","expanded","computed","_pattern","inputElement","inputs","inputEl","ComboboxPattern","inputValue","containerEl","nativeElement","popupControls","controls","constructor","afterRenderEffect","contentVisible","set","deps","target","i0","ɵɵFactoryTarget","Directive","ɵdir","ɵɵngDeclareDirective","minVersion","version","type","descendants","isSignal","exportAs","hostDirectives","directive","i1","ngImport","decorators","args","selector","host","ComboboxInput","combobox","model","items","untracked","onFilter","isStandalone","classPropertyName","publicName","isRequired","transformFunction","outputs","attributes","properties","ComboboxPopupContainer","DeferredContent"],"mappings":"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"}