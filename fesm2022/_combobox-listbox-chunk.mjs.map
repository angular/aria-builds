{"version":3,"file":"_combobox-listbox-chunk.mjs","sources":["../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/behaviors/list-selection/list-selection.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/behaviors/list-typeahead/list-typeahead.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/behaviors/list/list.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/listbox.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/option.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/combobox-listbox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {SignalLike, WritableSignalLike} from '../signal-like/signal-like';\nimport {ListFocus, ListFocusInputs, ListFocusItem} from '../list-focus/list-focus';\n\n/** Represents an item in a collection, such as a listbox option, that can be selected. */\nexport interface ListSelectionItem<V> extends ListFocusItem {\n  /** The value of the item. */\n  value: SignalLike<V>;\n\n  /** Whether the item is selectable. */\n  selectable: SignalLike<boolean>;\n}\n\n/** Represents the required inputs for a collection that contains selectable items. */\nexport interface ListSelectionInputs<T extends ListSelectionItem<V>, V> extends ListFocusInputs<T> {\n  /** Whether multiple items in the list can be selected at once. */\n  multi: SignalLike<boolean>;\n\n  /** The current value of the list selection. */\n  values: WritableSignalLike<V[]>;\n\n  /** The selection strategy used by the list. */\n  selectionMode: SignalLike<'follow' | 'explicit'>;\n}\n\n/** Controls selection for a list of items. */\nexport class ListSelection<T extends ListSelectionItem<V>, V> {\n  /** The start index to use for range selection. */\n  rangeStartIndex = signal<number>(0);\n\n  /** The end index to use for range selection. */\n  rangeEndIndex = signal<number>(0);\n\n  /** The currently selected items. */\n  selectedItems = computed(() =>\n    this.inputs.items().filter(item => this.inputs.values().includes(item.value())),\n  );\n\n  constructor(readonly inputs: ListSelectionInputs<T, V> & {focusManager: ListFocus<T>}) {}\n\n  /** Selects the item at the current active index. */\n  select(item?: ListSelectionItem<V>, opts = {anchor: true}) {\n    item = item ?? (this.inputs.focusManager.inputs.activeItem() as ListSelectionItem<V>);\n\n    if (\n      !item ||\n      item.disabled() ||\n      !item.selectable() ||\n      this.inputs.values().includes(item.value())\n    ) {\n      return;\n    }\n\n    if (!this.inputs.multi()) {\n      this.deselectAll();\n    }\n\n    const index = this.inputs.items().findIndex(i => i === item);\n    if (opts.anchor) {\n      this.beginRangeSelection(index);\n    }\n    this.inputs.values.update(values => values.concat(item.value()));\n  }\n\n  /** Deselects the item at the current active index. */\n  deselect(item?: ListSelectionItem<V>) {\n    item = item ?? this.inputs.focusManager.inputs.activeItem();\n\n    if (item && !item.disabled() && item.selectable()) {\n      this.inputs.values.update(values => values.filter(value => value !== item.value()));\n    }\n  }\n\n  /** Toggles the item at the current active index. */\n  toggle(item?: ListSelectionItem<V>) {\n    item = item ?? this.inputs.focusManager.inputs.activeItem();\n    if (item) {\n      this.inputs.values().includes(item.value()) ? this.deselect(item) : this.select(item);\n    }\n  }\n\n  /** Toggles only the item at the current active index. */\n  toggleOne() {\n    const item = this.inputs.focusManager.inputs.activeItem();\n    if (item) {\n      this.inputs.values().includes(item.value()) ? this.deselect() : this.selectOne();\n    }\n  }\n\n  /** Selects all items in the list. */\n  selectAll() {\n    if (!this.inputs.multi()) {\n      return; // Should we log a warning?\n    }\n\n    for (const item of this.inputs.items()) {\n      this.select(item, {anchor: false});\n    }\n\n    this.beginRangeSelection();\n  }\n\n  /** Deselects all items in the list. */\n  deselectAll() {\n    // If an item is not in the list, it forcefully gets deselected.\n    // This actually creates a bug for the following edge case:\n    //\n    // Setup: An item is not in the list (maybe it's lazily loaded), and it is disabled & selected.\n    // Expected: If deselectAll() is called, it should NOT get deselected (because it is disabled).\n    // Actual: Calling deselectAll() will still deselect the item.\n    //\n    // Why? Because we can't check if the item is disabled if it's not in the list.\n    //\n    // Alternatively, we could NOT deselect items that are not in the list, but this has the\n    // inverse (and more common) effect of keeping enabled items selected when they aren't in the\n    // list.\n\n    for (const value of this.inputs.values()) {\n      const item = this.inputs.items().find(i => i.value() === value);\n\n      item\n        ? this.deselect(item)\n        : this.inputs.values.update(values => values.filter(v => v !== value));\n    }\n  }\n\n  /**\n   * Selects all items in the list or deselects all\n   * items in the list if all items are already selected.\n   */\n  toggleAll() {\n    const selectableValues = this.inputs\n      .items()\n      .filter(i => !i.disabled() && i.selectable())\n      .map(i => i.value());\n\n    selectableValues.every(i => this.inputs.values().includes(i))\n      ? this.deselectAll()\n      : this.selectAll();\n  }\n\n  /** Sets the selection to only the current active item. */\n  selectOne() {\n    const item = this.inputs.focusManager.inputs.activeItem();\n    if (item && (item.disabled() || !item.selectable())) {\n      return;\n    }\n\n    this.deselectAll();\n\n    if (this.inputs.values().length > 0 && !this.inputs.multi()) {\n      return;\n    }\n\n    this.select();\n  }\n\n  /**\n   * Selects all items in the list up to the anchor item.\n   *\n   * Deselects all items that were previously within the\n   * selected range that are now outside of the selected range\n   */\n  selectRange(opts = {anchor: true}) {\n    const isStartOfRange = this.inputs.focusManager.prevActiveIndex() === this.rangeStartIndex();\n\n    if (isStartOfRange && opts.anchor) {\n      this.beginRangeSelection(this.inputs.focusManager.prevActiveIndex());\n    }\n\n    const itemsInRange = this._getItemsFromIndex(this.rangeStartIndex());\n    const itemsOutOfRange = this._getItemsFromIndex(this.rangeEndIndex()).filter(\n      i => !itemsInRange.includes(i),\n    );\n\n    for (const item of itemsOutOfRange) {\n      this.deselect(item);\n    }\n\n    for (const item of itemsInRange) {\n      this.select(item, {anchor: false});\n    }\n\n    if (itemsInRange.length) {\n      const item = itemsInRange.pop();\n      const index = this.inputs.items().findIndex(i => i === item);\n      this.rangeEndIndex.set(index);\n    }\n  }\n\n  /** Marks the given index as the start of a range selection. */\n  beginRangeSelection(index: number = this.inputs.focusManager.activeIndex()) {\n    this.rangeStartIndex.set(index);\n    this.rangeEndIndex.set(index);\n  }\n\n  /** Returns the items in the list starting from the given index.  */\n  private _getItemsFromIndex(index: number) {\n    if (index === -1) {\n      return [];\n    }\n\n    const upper = Math.max(this.inputs.focusManager.activeIndex(), index);\n    const lower = Math.min(this.inputs.focusManager.activeIndex(), index);\n\n    const items = [];\n    for (let i = lower; i <= upper; i++) {\n      items.push(this.inputs.items()[i]);\n    }\n\n    if (this.inputs.focusManager.activeIndex() < index) {\n      return items.reverse();\n    }\n\n    return items;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {SignalLike} from '../signal-like/signal-like';\nimport {ListFocus, ListFocusInputs, ListFocusItem} from '../list-focus/list-focus';\n\n/**\n * Represents an item in a collection, such as a listbox option, than can be navigated to by\n * typeahead.\n */\nexport interface ListTypeaheadItem extends ListFocusItem {\n  /** The text used by the typeahead search. */\n  searchTerm: SignalLike<string>;\n}\n\n/**\n * Represents the required inputs for a collection that contains items that can be navigated to by\n * typeahead.\n */\nexport interface ListTypeaheadInputs<T extends ListTypeaheadItem> extends ListFocusInputs<T> {\n  /** The amount of time before the typeahead search is reset. */\n  typeaheadDelay: SignalLike<number>;\n}\n\n/** Controls typeahead for a list of items. */\nexport class ListTypeahead<T extends ListTypeaheadItem> {\n  /** A reference to the timeout for resetting the typeahead search. */\n  timeout?: ReturnType<typeof setTimeout> | undefined;\n\n  /** The focus controller of the parent list. */\n  focusManager: ListFocus<T>;\n\n  /** Whether the user is actively typing a typeahead search query. */\n  isTyping = computed(() => this._query().length > 0);\n\n  /** Keeps track of the characters that typeahead search is being called with. */\n  private _query = signal('');\n\n  /** The index where that the typeahead search was initiated from. */\n  private _startIndex = signal<number | undefined>(undefined);\n\n  constructor(readonly inputs: ListTypeaheadInputs<T> & {focusManager: ListFocus<T>}) {\n    this.focusManager = inputs.focusManager;\n  }\n\n  /** Performs a typeahead search, appending the given character to the search string. */\n  search(char: string): boolean {\n    if (char.length !== 1) {\n      return false;\n    }\n\n    if (!this.isTyping() && char === ' ') {\n      return false;\n    }\n\n    if (this._startIndex() === undefined) {\n      this._startIndex.set(this.focusManager.activeIndex());\n    }\n\n    clearTimeout(this.timeout);\n    this._query.update(q => q + char.toLowerCase());\n    const item = this._getItem();\n\n    if (item) {\n      this.focusManager.focus(item);\n    }\n\n    this.timeout = setTimeout(() => {\n      this._query.set('');\n      this._startIndex.set(undefined);\n    }, this.inputs.typeaheadDelay());\n\n    return true;\n  }\n\n  /**\n   * Returns the first item whose search term matches the\n   * current query starting from the the current anchor index.\n   */\n  private _getItem() {\n    let items = this.focusManager.inputs.items();\n    const after = items.slice(this._startIndex()! + 1);\n    const before = items.slice(0, this._startIndex()!);\n    items = after.concat(before);\n    items.push(this.inputs.items()[this._startIndex()!]);\n\n    const focusableItems = [];\n    for (const item of items) {\n      if (this.focusManager.isFocusable(item)) {\n        focusableItems.push(item);\n      }\n    }\n\n    return focusableItems.find(i => i.searchTerm().toLowerCase().startsWith(this._query()));\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, signal} from '@angular/core';\nimport {ListFocus, ListFocusInputs, ListFocusItem} from '../list-focus/list-focus';\nimport {\n  ListNavigation,\n  ListNavigationInputs,\n  ListNavigationItem,\n} from '../list-navigation/list-navigation';\nimport {\n  ListSelection,\n  ListSelectionInputs,\n  ListSelectionItem,\n} from '../list-selection/list-selection';\nimport {\n  ListTypeahead,\n  ListTypeaheadInputs,\n  ListTypeaheadItem,\n} from '../list-typeahead/list-typeahead';\n\n/** The operations that the list can perform after navigation. */\ninterface NavOptions {\n  toggle?: boolean;\n  select?: boolean;\n  selectOne?: boolean;\n  selectRange?: boolean;\n  anchor?: boolean;\n  focusElement?: boolean;\n}\n\n/** Represents an item in the list. */\nexport type ListItem<V> = ListTypeaheadItem &\n  ListNavigationItem &\n  ListSelectionItem<V> &\n  ListFocusItem;\n\n/** The necessary inputs for the list behavior. */\nexport type ListInputs<T extends ListItem<V>, V> = ListFocusInputs<T> &\n  ListNavigationInputs<T> &\n  ListSelectionInputs<T, V> &\n  ListTypeaheadInputs<T>;\n\n/** Controls the state of a list. */\nexport class List<T extends ListItem<V>, V> {\n  /** Controls navigation for the list. */\n  navigationBehavior: ListNavigation<T>;\n\n  /** Controls selection for the list. */\n  selectionBehavior: ListSelection<T, V>;\n\n  /** Controls typeahead for the list. */\n  typeaheadBehavior: ListTypeahead<T>;\n\n  /** Controls focus for the list. */\n  focusBehavior: ListFocus<T>;\n\n  /** Whether the list is disabled. */\n  disabled = computed(() => this.focusBehavior.isListDisabled());\n\n  /** The id of the current active item. */\n  activeDescendant = computed(() => this.focusBehavior.getActiveDescendant());\n\n  /** The tab index of the list. */\n  tabIndex = computed(() => this.focusBehavior.getListTabIndex());\n\n  /** The index of the currently active item in the list. */\n  activeIndex = computed(() => this.focusBehavior.activeIndex());\n\n  /**\n   * The uncommitted index for selecting a range of options.\n   *\n   * NOTE: This is subtly distinct from the \"rangeStartIndex\" in the ListSelection behavior.\n   * The anchorIndex does not necessarily represent the start of a range, but represents the most\n   * recent index where the user showed intent to begin a range selection. Usually, this is wherever\n   * the user most recently pressed the \"Shift\" key, but if the user presses shift + space to select\n   * from the anchor, the user is not intending to start a new range from this index.\n   *\n   * In other words, \"rangeStartIndex\" is only set when a user commits to starting a range selection\n   * while \"anchorIndex\" is set whenever a user indicates they may be starting a range selection.\n   */\n  private _anchorIndex = signal(0);\n\n  /** Whether the list should wrap. Used to disable wrapping while range selecting. */\n  private _wrap = signal(true);\n\n  constructor(readonly inputs: ListInputs<T, V>) {\n    this.focusBehavior = new ListFocus(inputs);\n    this.selectionBehavior = new ListSelection({...inputs, focusManager: this.focusBehavior});\n    this.typeaheadBehavior = new ListTypeahead({...inputs, focusManager: this.focusBehavior});\n    this.navigationBehavior = new ListNavigation({\n      ...inputs,\n      focusManager: this.focusBehavior,\n      wrap: computed(() => this._wrap() && this.inputs.wrap()),\n    });\n  }\n\n  /** Returns the tab index for the given item. */\n  getItemTabindex(item: T) {\n    return this.focusBehavior.getItemTabIndex(item);\n  }\n\n  /** Navigates to the first option in the list. */\n  first(opts?: NavOptions) {\n    this._navigate(opts, () => this.navigationBehavior.first(opts));\n  }\n\n  /** Navigates to the last option in the list. */\n  last(opts?: NavOptions) {\n    this._navigate(opts, () => this.navigationBehavior.last(opts));\n  }\n\n  /** Navigates to the next option in the list. */\n  next(opts?: NavOptions) {\n    this._navigate(opts, () => this.navigationBehavior.next(opts));\n  }\n\n  /** Navigates to the previous option in the list. */\n  prev(opts?: NavOptions) {\n    this._navigate(opts, () => this.navigationBehavior.prev(opts));\n  }\n\n  /** Navigates to the given item in the list. */\n  goto(item: T, opts?: NavOptions) {\n    this._navigate(opts, () => this.navigationBehavior.goto(item, opts));\n  }\n\n  /** Removes focus from the list. */\n  unfocus() {\n    this.inputs.activeItem.set(undefined);\n  }\n\n  /** Marks the given index as the potential start of a range selection. */\n  anchor(index: number) {\n    this._anchorIndex.set(index);\n  }\n\n  /** Handles typeahead search navigation for the list. */\n  search(char: string, opts?: NavOptions) {\n    this._navigate(opts, () => this.typeaheadBehavior.search(char));\n  }\n\n  /** Checks if the list is currently typing for typeahead search. */\n  isTyping() {\n    return this.typeaheadBehavior.isTyping();\n  }\n\n  /** Selects the currently active item in the list. */\n  select(item?: T) {\n    this.selectionBehavior.select(item);\n  }\n\n  /** Sets the selection to only the current active item. */\n  selectOne() {\n    this.selectionBehavior.selectOne();\n  }\n\n  /** Deselects the currently active item in the list. */\n  deselect(item?: T) {\n    this.selectionBehavior.deselect(item);\n  }\n\n  /** Deselects all items in the list. */\n  deselectAll() {\n    this.selectionBehavior.deselectAll();\n  }\n\n  /** Toggles the currently active item in the list. */\n  toggle(item?: T) {\n    this.selectionBehavior.toggle(item);\n  }\n\n  /** Toggles the currently active item in the list, deselecting all other items. */\n  toggleOne() {\n    this.selectionBehavior.toggleOne();\n  }\n\n  /** Toggles the selection of all items in the list. */\n  toggleAll() {\n    this.selectionBehavior.toggleAll();\n  }\n\n  /** Checks if the given item is able to receive focus. */\n  isFocusable(item: T) {\n    return this.focusBehavior.isFocusable(item);\n  }\n\n  /** Handles updating selection for the list. */\n  updateSelection(opts: NavOptions = {anchor: true}) {\n    if (opts.toggle) {\n      this.selectionBehavior.toggle();\n    }\n    if (opts.select) {\n      this.selectionBehavior.select();\n    }\n    if (opts.selectOne) {\n      this.selectionBehavior.selectOne();\n    }\n    if (opts.selectRange) {\n      this.selectionBehavior.selectRange();\n    }\n    if (!opts.anchor) {\n      this.anchor(this.selectionBehavior.rangeStartIndex());\n    }\n  }\n\n  /**\n   * Safely performs a navigation operation.\n   *\n   * Handles conditionally disabling wrapping for when a navigation\n   * operation is occurring while the user is selecting a range of options.\n   *\n   * Handles boilerplate calling of focus & selection operations. Also ensures these\n   * additional operations are only called if the navigation operation moved focus to a new option.\n   */\n  private _navigate(opts: NavOptions = {}, operation: () => boolean) {\n    if (opts?.selectRange) {\n      this._wrap.set(false);\n      this.selectionBehavior.rangeStartIndex.set(this._anchorIndex());\n    }\n\n    const moved = operation();\n\n    if (moved) {\n      this.updateSelection(opts);\n    }\n\n    this._wrap.set(true);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {OptionPattern} from './option';\nimport {KeyboardEventManager, PointerEventManager, Modifier} from '../behaviors/event-manager';\nimport {computed, signal} from '@angular/core';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport {List, ListInputs} from '../behaviors/list/list';\n\n/** Represents the required inputs for a listbox. */\nexport type ListboxInputs<V> = ListInputs<OptionPattern<V>, V> & {\n  /** A unique identifier for the listbox. */\n  id: SignalLike<string>;\n\n  /** Whether the listbox is readonly. */\n  readonly: SignalLike<boolean>;\n};\n\n/** Controls the state of a listbox. */\nexport class ListboxPattern<V> {\n  listBehavior: List<OptionPattern<V>, V>;\n\n  /** Whether the list is vertically or horizontally oriented. */\n  orientation: SignalLike<'vertical' | 'horizontal'>;\n\n  /** Whether the listbox is disabled. */\n  disabled = computed(() => this.listBehavior.disabled());\n\n  /** Whether the listbox is readonly. */\n  readonly: SignalLike<boolean>;\n\n  /** The tab index of the listbox. */\n  tabIndex: SignalLike<-1 | 0> = computed(() => this.listBehavior.tabIndex());\n\n  /** The id of the current active item. */\n  activeDescendant = computed(() => this.listBehavior.activeDescendant());\n\n  /** Whether multiple items in the list can be selected at once. */\n  multi: SignalLike<boolean>;\n\n  /** The number of items in the listbox. */\n  setsize = computed(() => this.inputs.items().length);\n\n  /** Whether the listbox selection follows focus. */\n  followFocus = computed(() => this.inputs.selectionMode() === 'follow');\n\n  /** Whether the listbox should wrap. Used to disable wrapping while range selecting. */\n  wrap = signal(true);\n\n  /** The key used to navigate to the previous item in the list. */\n  prevKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowUp';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft';\n  });\n\n  /** The key used to navigate to the next item in the list. */\n  nextKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowDown';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight';\n  });\n\n  /** Represents the space key. Does nothing when the user is actively using typeahead. */\n  dynamicSpaceKey = computed(() => (this.listBehavior.isTyping() ? '' : ' '));\n\n  /** The regexp used to decide if a key should trigger typeahead. */\n  typeaheadRegexp = /^.$/;\n\n  /** The keydown event manager for the listbox. */\n  keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    if (this.readonly()) {\n      return manager\n        .on(this.prevKey, () => this.listBehavior.prev())\n        .on(this.nextKey, () => this.listBehavior.next())\n        .on('Home', () => this.listBehavior.first())\n        .on('End', () => this.listBehavior.last())\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n    }\n\n    if (!this.followFocus()) {\n      manager\n        .on(this.prevKey, () => this.listBehavior.prev())\n        .on(this.nextKey, () => this.listBehavior.next())\n        .on('Home', () => this.listBehavior.first())\n        .on('End', () => this.listBehavior.last())\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n    }\n\n    if (this.followFocus()) {\n      manager\n        .on(this.prevKey, () => this.listBehavior.prev({selectOne: true}))\n        .on(this.nextKey, () => this.listBehavior.next({selectOne: true}))\n        .on('Home', () => this.listBehavior.first({selectOne: true}))\n        .on('End', () => this.listBehavior.last({selectOne: true}))\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key, {selectOne: true}));\n    }\n\n    if (this.inputs.multi()) {\n      manager\n        .on(Modifier.Any, 'Shift', () => this.listBehavior.anchor(this.listBehavior.activeIndex()))\n        .on(Modifier.Shift, this.prevKey, () => this.listBehavior.prev({selectRange: true}))\n        .on(Modifier.Shift, this.nextKey, () => this.listBehavior.next({selectRange: true}))\n        .on([Modifier.Ctrl | Modifier.Shift, Modifier.Meta | Modifier.Shift], 'Home', () =>\n          this.listBehavior.first({selectRange: true, anchor: false}),\n        )\n        .on([Modifier.Ctrl | Modifier.Shift, Modifier.Meta | Modifier.Shift], 'End', () =>\n          this.listBehavior.last({selectRange: true, anchor: false}),\n        )\n        .on(Modifier.Shift, 'Enter', () =>\n          this.listBehavior.updateSelection({selectRange: true, anchor: false}),\n        )\n        .on(Modifier.Shift, this.dynamicSpaceKey, () =>\n          this.listBehavior.updateSelection({selectRange: true, anchor: false}),\n        );\n    }\n\n    if (!this.followFocus() && this.inputs.multi()) {\n      manager\n        .on(this.dynamicSpaceKey, () => this.listBehavior.toggle())\n        .on('Enter', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => this.listBehavior.toggleAll());\n    }\n\n    if (!this.followFocus() && !this.inputs.multi()) {\n      manager.on(this.dynamicSpaceKey, () => this.listBehavior.toggleOne());\n      manager.on('Enter', () => this.listBehavior.toggleOne());\n    }\n\n    if (this.inputs.multi() && this.followFocus()) {\n      manager\n        .on([Modifier.Ctrl, Modifier.Meta], this.prevKey, () => this.listBehavior.prev())\n        .on([Modifier.Ctrl, Modifier.Meta], this.nextKey, () => this.listBehavior.next())\n        .on([Modifier.Ctrl, Modifier.Meta], ' ', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'Enter', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'Home', () => this.listBehavior.first())\n        .on([Modifier.Ctrl, Modifier.Meta], 'End', () => this.listBehavior.last())\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => {\n          this.listBehavior.toggleAll();\n          this.listBehavior.select(); // Ensure the currect option remains selected.\n        });\n    }\n\n    return manager;\n  });\n\n  /** The pointerdown event manager for the listbox. */\n  pointerdown = computed(() => {\n    const manager = new PointerEventManager();\n\n    if (this.readonly()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!));\n    }\n\n    if (this.multi()) {\n      manager.on(Modifier.Shift, e =>\n        this.listBehavior.goto(this._getItem(e)!, {selectRange: true}),\n      );\n    }\n\n    if (!this.multi() && this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {selectOne: true}));\n    }\n\n    if (!this.multi() && !this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    if (this.multi() && this.followFocus()) {\n      return manager\n        .on(e => this.listBehavior.goto(this._getItem(e)!, {selectOne: true}))\n        .on(Modifier.Ctrl, e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    if (this.multi() && !this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    return manager;\n  });\n\n  constructor(readonly inputs: ListboxInputs<V>) {\n    this.readonly = inputs.readonly;\n    this.orientation = inputs.orientation;\n    this.multi = inputs.multi;\n    this.listBehavior = new List(inputs);\n  }\n\n  /** Returns a set of violations */\n  validate(): string[] {\n    const violations: string[] = [];\n\n    if (!this.inputs.multi() && this.inputs.values().length > 1) {\n      violations.push(\n        `A single-select listbox should not have multiple selected options. Selected options: ${this.inputs.values().join(', ')}`,\n      );\n    }\n\n    return violations;\n  }\n\n  /** Handles keydown events for the listbox. */\n  onKeydown(event: KeyboardEvent) {\n    if (!this.disabled()) {\n      this.keydown().handle(event);\n    }\n  }\n\n  onPointerdown(event: PointerEvent) {\n    if (!this.disabled()) {\n      this.pointerdown().handle(event);\n    }\n  }\n\n  /**\n   * Sets the listbox to it's default initial state.\n   *\n   * Sets the active index of the listbox to the first focusable selected\n   * item if one exists. Otherwise, sets focus to the first focusable item.\n   *\n   * This method should be called once the listbox and it's options are properly initialized,\n   * meaning the ListboxPattern and OptionPatterns should have references to each other before this\n   * is called.\n   */\n  setDefaultState() {\n    let firstItem: OptionPattern<V> | null = null;\n\n    for (const item of this.inputs.items()) {\n      if (this.listBehavior.isFocusable(item)) {\n        if (!firstItem) {\n          firstItem = item;\n        }\n        if (item.selected()) {\n          this.inputs.activeItem.set(item);\n          return;\n        }\n      }\n    }\n\n    if (firstItem) {\n      this.inputs.activeItem.set(firstItem);\n    }\n  }\n\n  protected _getItem(e: PointerEvent) {\n    if (!(e.target instanceof HTMLElement)) {\n      return;\n    }\n\n    const element = e.target.closest('[role=\"option\"]');\n    return this.inputs.items().find(i => i.element() === element);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport {List, ListInputs, ListItem} from '../behaviors/list/list';\n\n/**\n * Represents the properties exposed by a listbox that need to be accessed by an option.\n * This exists to avoid circular dependency errors between the listbox and option.\n */\ninterface ListboxPattern<V> {\n  inputs: ListInputs<OptionPattern<V>, V>;\n  listBehavior: List<OptionPattern<V>, V>;\n}\n\n/** Represents the required inputs for an option in a listbox. */\nexport interface OptionInputs<V> extends Omit<ListItem<V>, 'index' | 'selectable'> {\n  listbox: SignalLike<ListboxPattern<V> | undefined>;\n}\n\n/** Represents an option in a listbox. */\nexport class OptionPattern<V> {\n  /** A unique identifier for the option. */\n  id: SignalLike<string>;\n\n  /** The value of the option. */\n  value: SignalLike<V>;\n\n  /** The position of the option in the list. */\n  index = computed(() => this.listbox()?.inputs.items().indexOf(this) ?? -1);\n\n  /** Whether the option is active. */\n  active = computed(() => this.listbox()?.inputs.activeItem() === this);\n\n  /** Whether the option is selected. */\n  selected = computed(() => this.listbox()?.inputs.values().includes(this.value()));\n\n  /** Whether the option is selectable. */\n  selectable = () => true;\n\n  /** Whether the option is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** The text used by the typeahead search. */\n  searchTerm: SignalLike<string>;\n\n  /** A reference to the parent listbox. */\n  listbox: SignalLike<ListboxPattern<V> | undefined>;\n\n  /** The tab index of the option. */\n  tabIndex = computed(() => this.listbox()?.listBehavior.getItemTabindex(this));\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement | undefined>;\n\n  constructor(args: OptionInputs<V>) {\n    this.id = args.id;\n    this.value = args.value;\n    this.listbox = args.listbox;\n    this.element = args.element;\n    this.disabled = args.disabled;\n    this.searchTerm = args.searchTerm;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed} from '@angular/core';\nimport {ListboxInputs, ListboxPattern} from './listbox';\nimport {SignalLike} from '../behaviors/signal-like/signal-like';\nimport {OptionPattern} from './option';\nimport {ComboboxPattern, ComboboxListboxControls} from '../combobox/combobox';\n\nexport type ComboboxListboxInputs<V> = ListboxInputs<V> & {\n  /** The combobox controlling the listbox. */\n  combobox: SignalLike<ComboboxPattern<OptionPattern<V>, V> | undefined>;\n};\n\nexport class ComboboxListboxPattern<V>\n  extends ListboxPattern<V>\n  implements ComboboxListboxControls<OptionPattern<V>, V>\n{\n  /** A unique identifier for the popup. */\n  id = computed(() => this.inputs.id());\n\n  /** The ARIA role for the listbox. */\n  role = computed(() => 'listbox' as const);\n\n  /** The id of the active (focused) item in the listbox. */\n  activeId = computed(() => this.listBehavior.activeDescendant());\n\n  /** The list of options in the listbox. */\n  items: SignalLike<OptionPattern<V>[]> = computed(() => this.inputs.items());\n\n  /** The tab index for the listbox. Always -1 because the combobox handles focus. */\n  override tabIndex: SignalLike<-1 | 0> = () => -1;\n\n  /** Whether multiple items in the list can be selected at once. */\n  override multi = computed(() => {\n    return this.inputs.combobox()?.readonly() ? this.inputs.multi() : false;\n  });\n\n  constructor(override readonly inputs: ComboboxListboxInputs<V>) {\n    if (inputs.combobox()) {\n      inputs.focusMode = () => 'activedescendant';\n      inputs.element = inputs.combobox()!.inputs.inputEl;\n    }\n\n    super(inputs);\n  }\n\n  /** Noop. The combobox handles keydown events. */\n  override onKeydown(_: KeyboardEvent): void {}\n\n  /** Noop. The combobox handles pointerdown events. */\n  override onPointerdown(_: PointerEvent): void {}\n\n  /** Noop. The combobox controls the open state. */\n  override setDefaultState(): void {}\n\n  /** Navigates to the specified item in the listbox. */\n  focus = (item: OptionPattern<V>, opts?: {focusElement?: boolean}) => {\n    this.listBehavior.goto(item, opts);\n  };\n\n  /** Navigates to the previous focusable item in the listbox. */\n  getActiveItem = () => this.inputs.activeItem();\n\n  /** Navigates to the next focusable item in the listbox. */\n  next = () => this.listBehavior.next();\n\n  /** Navigates to the previous focusable item in the listbox. */\n  prev = () => this.listBehavior.prev();\n\n  /** Navigates to the last focusable item in the listbox. */\n  last = () => this.listBehavior.last();\n\n  /** Navigates to the first focusable item in the listbox. */\n  first = () => this.listBehavior.first();\n\n  /** Unfocuses the currently focused item in the listbox. */\n  unfocus = () => this.listBehavior.unfocus();\n\n  /** Selects the specified item in the listbox. */\n  select = (item?: OptionPattern<V>) => this.listBehavior.select(item);\n\n  /** Toggles the selection state of the given item in the listbox. */\n  toggle = (item?: OptionPattern<V>) => this.listBehavior.toggle(item);\n\n  /** Clears the selection in the listbox. */\n  clearSelection = () => this.listBehavior.deselectAll();\n\n  /** Retrieves the OptionPattern associated with a pointer event. */\n  getItem = (e: PointerEvent) => this._getItem(e);\n\n  /** Retrieves the currently selected items in the listbox. */\n  getSelectedItems = () => {\n    // NOTE: We need to do this funky for loop to preserve the order of the selected values.\n    const items = [];\n    for (const value of this.inputs.values()) {\n      const item = this.items().find(i => i.value() === value);\n      if (item) {\n        items.push(item);\n      }\n    }\n    return items;\n  };\n\n  /** Sets the value of the combobox listbox. */\n  setValue = (value: V | undefined) => this.inputs.values.set(value ? [value] : []);\n}\n"],"names":["ListSelection","inputs","rangeStartIndex","signal","rangeEndIndex","selectedItems","computed","items","filter","item","values","includes","value","constructor","select","opts","anchor","focusManager","activeItem","disabled","selectable","multi","deselectAll","index","findIndex","i","beginRangeSelection","update","concat","deselect","toggle","toggleOne","selectOne","selectAll","find","v","toggleAll","selectableValues","map","every","length","selectRange","isStartOfRange","prevActiveIndex","itemsInRange","_getItemsFromIndex","itemsOutOfRange","pop","set","activeIndex","upper","Math","max","lower","min","push","reverse","ListTypeahead","timeout","isTyping","_query","_startIndex","undefined","search","char","clearTimeout","q","toLowerCase","_getItem","focus","setTimeout","typeaheadDelay","after","slice","before","focusableItems","isFocusable","searchTerm","startsWith","List","navigationBehavior","selectionBehavior","typeaheadBehavior","focusBehavior","isListDisabled","activeDescendant","getActiveDescendant","tabIndex","getListTabIndex","_anchorIndex","_wrap","ListFocus","ListNavigation","wrap","getItemTabindex","getItemTabIndex","first","_navigate","last","next","prev","goto","unfocus","updateSelection","operation","moved","ListboxPattern","listBehavior","orientation","readonly","setsize","followFocus","selectionMode","prevKey","textDirection","nextKey","dynamicSpaceKey","typeaheadRegexp","keydown","manager","KeyboardEventManager","on","e","key","Modifier","Any","Shift","Ctrl","Meta","pointerdown","PointerEventManager","validate","violations","join","onKeydown","event","handle","onPointerdown","setDefaultState","firstItem","selected","target","HTMLElement","element","closest","OptionPattern","id","listbox","indexOf","active","args","ComboboxListboxPattern","role","activeId","combobox","focusMode","inputEl","_","getActiveItem","clearSelection","getItem","getSelectedItems","setValue"],"mappings":"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"}